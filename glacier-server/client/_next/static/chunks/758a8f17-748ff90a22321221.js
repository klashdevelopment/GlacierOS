"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[517],{8518:function(e,t,i){let s;i.d(t,{GL:function(){return disposeTabster},GX:function(){return getMover},V0:function(){return getModalizer},Yk:function(){return b},h2:function(){return getGroupper},ox:function(){return createTabster},w9:function(){return getRestorer},yS:function(){return getTabsterAttribute}});var o=i(9907);/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */let r="data-tabster",n="data-tabster-dummy",l="a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), *[tabindex], *[contenteditable], details > summary, audio[controls], video[controls]",a={EscapeGroupper:1,Restorer:2,Deloser:3},u={Invisible:0,PartiallyVisible:1,Visible:2},d={Source:0,Target:1},c={Both:0,Vertical:1,Horizontal:2,Grid:3,GridLinear:4},h={ArrowUp:1,ArrowDown:2,ArrowLeft:3,ArrowRight:4,PageUp:5,PageDown:6,Home:7,End:8},m={Unlimited:0,Limited:1,LimitedTrapFocus:2},_={Enter:1,Escape:2},v={Auto:0,Inside:1,Outside:2};var b=Object.freeze({__proto__:null,TabsterAttributeName:r,TabsterDummyInputAttributeName:n,FocusableSelector:l,AsyncFocusSources:a,ObservedElementAccesibilities:{Any:0,Accessible:1,Focusable:2},RestoreFocusOrders:{History:0,DeloserDefault:1,RootDefault:2,DeloserFirst:3,RootFirst:4},DeloserStrategies:{Auto:0,Manual:1},Visibilities:u,RestorerTypes:d,MoverDirections:c,MoverKeys:h,GroupperTabbabilities:m,GroupperMoveFocusActions:_,SysDummyInputsPositions:v});/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */function getTabsterOnElement(e,t){var i;return null===(i=e.storageEntry(t))||void 0===i?void 0:i.tabster}function updateTabsterByAttribute(e,t,i){var s,o;let n;let l=i||e._noop?void 0:t.getAttribute(r),a=e.storageEntry(t);if(l){if(l===(null===(s=null==a?void 0:a.attr)||void 0===s?void 0:s.string))return;try{let e=JSON.parse(l);if("object"!=typeof e)throw Error(`Value is not a JSON object, got '${l}'.`);n={string:l,object:e}}catch(e){}}else if(!a)return;a||(a=e.storageEntry(t,!0)),a.tabster||(a.tabster={});let u=a.tabster||{},d=(null===(o=a.attr)||void 0===o?void 0:o.object)||{},c=(null==n?void 0:n.object)||{};for(let i of Object.keys(d))if(!c[i]){if("root"===i){let t=u[i];t&&e.root.onRoot(t,!0)}switch(i){case"deloser":case"root":case"groupper":case"modalizer":case"restorer":case"mover":let s=u[i];s&&(s.dispose(),delete u[i]);break;case"observed":delete u[i],e.observedElement&&e.observedElement.onObservedElementUpdate(t);break;case"focusable":case"outline":case"uncontrolled":case"sys":delete u[i]}}for(let i of Object.keys(c)){let s=c.sys;switch(i){case"deloser":u.deloser?u.deloser.setProps(c.deloser):e.deloser&&(u.deloser=e.deloser.createDeloser(t,c.deloser));break;case"root":u.root?u.root.setProps(c.root):u.root=e.root.createRoot(t,c.root,s),e.root.onRoot(u.root);break;case"modalizer":u.modalizer?u.modalizer.setProps(c.modalizer):e.modalizer&&(u.modalizer=e.modalizer.createModalizer(t,c.modalizer,s));break;case"restorer":u.restorer?u.restorer.setProps(c.restorer):e.restorer&&c.restorer&&(u.restorer=e.restorer.createRestorer(t,c.restorer));break;case"focusable":u.focusable=c.focusable;break;case"groupper":u.groupper?u.groupper.setProps(c.groupper):e.groupper&&(u.groupper=e.groupper.createGroupper(t,c.groupper,s));break;case"mover":u.mover?u.mover.setProps(c.mover):e.mover&&(u.mover=e.mover.createMover(t,c.mover,s));break;case"observed":e.observedElement&&(u.observed=c.observed,e.observedElement.onObservedElementUpdate(t));break;case"uncontrolled":u.uncontrolled=c.uncontrolled;break;case"outline":e.outline&&(u.outline=c.outline);break;case"sys":u.sys=c.sys;break;default:console.error(`Unknown key '${i}' in data-tabster attribute value.`)}}n?a.attr=n:(0===Object.keys(u).length&&(delete a.tabster,delete a.attr),e.storageEntry(t,!1))}let f="tabster:mover:movefocus",p="tabster:mover:memorized-element",g="tabster:groupper:movefocus",E="tabster:restorer:restore-focus",T="undefined"!=typeof CustomEvent?CustomEvent:function(){};let TabsterCustomEvent=class TabsterCustomEvent extends T{constructor(e,t){super(e,{bubbles:!0,cancelable:!0,composed:!0,detail:t}),this.details=t}};let TabsterFocusInEvent=class TabsterFocusInEvent extends TabsterCustomEvent{constructor(e){super("tabster:focusin",e)}};let TabsterFocusOutEvent=class TabsterFocusOutEvent extends TabsterCustomEvent{constructor(e){super("tabster:focusout",e)}};let TabsterMoveFocusEvent=class TabsterMoveFocusEvent extends TabsterCustomEvent{constructor(e){super("tabster:movefocus",e)}};let MoverStateEvent=class MoverStateEvent extends TabsterCustomEvent{constructor(e){super("tabster:mover:state",e)}};let ModalizerActiveEvent=class ModalizerActiveEvent extends TabsterCustomEvent{constructor(e){super("tabster:modalizer:active",e)}};let ModalizerInactiveEvent=class ModalizerInactiveEvent extends TabsterCustomEvent{constructor(e){super("tabster:modalizer:inactive",e)}};let RestorerRestoreFocusEvent=class RestorerRestoreFocusEvent extends TabsterCustomEvent{constructor(){super(E)}};let RootFocusEvent=class RootFocusEvent extends TabsterCustomEvent{constructor(e){super("tabster:root:focus",e)}};let RootBlurEvent=class RootBlurEvent extends TabsterCustomEvent{constructor(e){super("tabster:root:blur",e)}};let y={createMutationObserver:e=>new MutationObserver(e),createTreeWalker:(e,t,i,s)=>e.createTreeWalker(t,i,s),getParentNode:e=>e?e.parentNode:null,getParentElement:e=>e?e.parentElement:null,nodeContains:(e,t)=>!!(t&&(null==e?void 0:e.contains(t))),getActiveElement:e=>e.activeElement,querySelector:(e,t)=>e.querySelector(t),querySelectorAll:(e,t)=>Array.prototype.slice.call(e.querySelectorAll(t),0),getElementById:(e,t)=>e.getElementById(t),getFirstChild:e=>(null==e?void 0:e.firstChild)||null,getLastChild:e=>(null==e?void 0:e.lastChild)||null,getNextSibling:e=>(null==e?void 0:e.nextSibling)||null,getPreviousSibling:e=>(null==e?void 0:e.previousSibling)||null,getFirstElementChild:e=>(null==e?void 0:e.firstElementChild)||null,getLastElementChild:e=>(null==e?void 0:e.lastElementChild)||null,getNextElementSibling:e=>(null==e?void 0:e.nextElementSibling)||null,getPreviousElementSibling:e=>(null==e?void 0:e.previousElementSibling)||null,appendChild:(e,t)=>e.appendChild(t),insertBefore:(e,t,i)=>e.insertBefore(t,i),getSelection:e=>{var t;return(null===(t=e.ownerDocument)||void 0===t?void 0:t.getSelection())||null}},w="undefined"!=typeof DOMRect?DOMRect:class{constructor(e,t,i,s){this.left=e||0,this.top=t||0,this.right=(e||0)+(i||0),this.bottom=(t||0)+(s||0)}},F=0;try{document.createTreeWalker(document,NodeFilter.SHOW_ELEMENT),s=!1}catch(e){s=!0}function getInstanceContext(e){let t=e(),i=t.__tabsterInstanceContext;return i||(i={elementByUId:{},basics:{Promise:t.Promise||void 0,WeakRef:t.WeakRef||void 0},containerBoundingRectCache:{},lastContainerBoundingRectCacheId:0,fakeWeakRefs:[],fakeWeakRefsStarted:!1},t.__tabsterInstanceContext=i),i}let FakeWeakRef=class FakeWeakRef{constructor(e){this._target=e}deref(){return this._target}static cleanup(e,t){return!e._target||(!!t||!documentContains(e._target.ownerDocument,e._target))&&(delete e._target,!0)}};let WeakHTMLElement=class WeakHTMLElement{constructor(e,t,i){let s;let o=getInstanceContext(e);o.WeakRef?s=new o.WeakRef(t):(s=new FakeWeakRef(t),o.fakeWeakRefs.push(s)),this._ref=s,this._data=i}get(){let e;let t=this._ref;return!t||(e=t.deref())||delete this._ref,e}getData(){return this._data}};function cleanupFakeWeakRefs(e,t){let i=getInstanceContext(e);i.fakeWeakRefs=i.fakeWeakRefs.filter(e=>!FakeWeakRef.cleanup(e,t))}function createElementTreeWalker(e,t,i){if(t.nodeType!==Node.ELEMENT_NODE)return;let o=s?i:{acceptNode:i};return y.createTreeWalker(e,t,NodeFilter.SHOW_ELEMENT,o,!1)}function getBoundingRect(e,t){let i=t.__tabsterCacheId,s=getInstanceContext(e),o=i?s.containerBoundingRectCache[i]:void 0;if(o)return o.rect;let r=t.ownerDocument&&t.ownerDocument.documentElement;if(!r)return new w;let n=0,l=0,a=r.clientWidth,u=r.clientHeight;if(t!==r){let e=t.getBoundingClientRect();n=Math.max(n,e.left),l=Math.max(l,e.top),a=Math.min(a,e.right),u=Math.min(u,e.bottom)}let d=new w(n<a?n:-1,l<u?l:-1,n<a?a-n:0,l<u?u-l:0);return i||(i="r-"+ ++s.lastContainerBoundingRectCacheId,t.__tabsterCacheId=i),s.containerBoundingRectCache[i]={rect:d,element:t},s.containerBoundingRectCacheTimer||(s.containerBoundingRectCacheTimer=window.setTimeout(()=>{for(let e of(s.containerBoundingRectCacheTimer=void 0,Object.keys(s.containerBoundingRectCache)))delete s.containerBoundingRectCache[e].element.__tabsterCacheId;s.containerBoundingRectCache={}},50)),d}function isElementVerticallyVisibleInContainer(e,t,i){let s=getScrollableContainer(t);if(!s)return!1;let o=getBoundingRect(e,s),r=t.getBoundingClientRect(),n=r.height*(1-i),l=Math.max(0,o.top-r.top),a=Math.max(0,r.bottom-o.bottom),u=l+a;return 0===u||u<=n}function getScrollableContainer(e){let t=e.ownerDocument;if(t){for(let t=y.getParentElement(e);t;t=y.getParentElement(t))if(t.scrollWidth>t.clientWidth||t.scrollHeight>t.clientHeight)return t;return t.documentElement}return null}function shouldIgnoreFocus(e){return!!e.__shouldIgnoreFocus}function getElementUId(e,t){let i=getInstanceContext(e),s=t.__tabsterElementUID;return s||(s=t.__tabsterElementUID=function(e){let t=new Uint32Array(4);if(e.crypto&&e.crypto.getRandomValues)e.crypto.getRandomValues(t);else if(e.msCrypto&&e.msCrypto.getRandomValues)e.msCrypto.getRandomValues(t);else for(let e=0;e<t.length;e++)t[e]=4294967295*Math.random();let i=[];for(let e=0;e<t.length;e++)i.push(t[e].toString(36));return i.push("|"),i.push((++F).toString(36)),i.push("|"),i.push(Date.now().toString(36)),i.join("")}(e())),!i.elementByUId[s]&&documentContains(t.ownerDocument,t)&&(i.elementByUId[s]=new WeakHTMLElement(e,t)),s}function clearElementCache(e,t){let i=getInstanceContext(e);for(let e of Object.keys(i.elementByUId)){let s=i.elementByUId[e],o=s&&s.get();(!o||!t||y.nodeContains(t,o))&&delete i.elementByUId[e]}}function documentContains(e,t){return y.nodeContains(null==e?void 0:e.body,t)}function matchesSelector(e,t){let i=e.matches||e.matchesSelector||e.msMatchesSelector||e.webkitMatchesSelector;return i&&i.call(e,t)}let I=0;let TabsterPart=class TabsterPart{constructor(e,t,i){let s=e.getWindow;this._tabster=e,this._element=new WeakHTMLElement(s,t),this._props={...i},this.id="i"+ ++I}getElement(){return this._element.get()}getProps(){return this._props}setProps(e){this._props={...e}}};let DummyInput=class DummyInput{constructor(e,t,i,s,r){var l;this._focusIn=e=>{if(this._fixedTarget){let e=this._fixedTarget.get();e&&(0,o.ev)(e);return}let t=this.input;if(this.onFocusIn&&t){let i=e.relatedTarget;this.onFocusIn(this,this._isBackward(!0,t,i),i)}},this._focusOut=e=>{if(this._fixedTarget)return;this.useDefaultAction=!1;let t=this.input;if(this.onFocusOut&&t){let i=e.relatedTarget;this.onFocusOut(this,this._isBackward(!1,t,i),i)}};let a=e(),u=a.document.createElement("i");u.tabIndex=0,u.setAttribute("role","none"),u.setAttribute(n,""),u.setAttribute("aria-hidden","true");let d=u.style;d.position="fixed",d.width=d.height="1px",d.opacity="0.001",d.zIndex="-1",d.setProperty("content-visibility","hidden"),u.__shouldIgnoreFocus=!0,this.input=u,this.isFirst=i.isFirst,this.isOutside=t,this._isPhantom=null!==(l=i.isPhantom)&&void 0!==l&&l,this._fixedTarget=r,u.addEventListener("focusin",this._focusIn),u.addEventListener("focusout",this._focusOut),u.__tabsterDummyContainer=s,this._isPhantom&&(this._disposeTimer=a.setTimeout(()=>{delete this._disposeTimer,this.dispose()},0),this._clearDisposeTimeout=()=>{this._disposeTimer&&(a.clearTimeout(this._disposeTimer),delete this._disposeTimer),delete this._clearDisposeTimeout})}dispose(){var e;this._clearDisposeTimeout&&this._clearDisposeTimeout();let t=this.input;t&&(delete this._fixedTarget,delete this.onFocusIn,delete this.onFocusOut,delete this.input,t.removeEventListener("focusin",this._focusIn),t.removeEventListener("focusout",this._focusOut),delete t.__tabsterDummyContainer,null===(e=y.getParentNode(t))||void 0===e||e.removeChild(t))}setTopLeft(e,t){var i;let s=null===(i=this.input)||void 0===i?void 0:i.style;s&&(s.top=`${e}px`,s.left=`${t}px`)}_isBackward(e,t,i){return e&&!i?!this.isFirst:!!(i&&t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_FOLLOWING)}};let DummyInputManager=class DummyInputManager{constructor(e,t,i,s,o,r){this._element=t,this._instance=new DummyInputManagerCore(e,t,this,i,s,o,r)}_setHandlers(e,t){this._onFocusIn=e,this._onFocusOut=t}moveOut(e){var t;null===(t=this._instance)||void 0===t||t.moveOut(e)}moveOutWithDefaultAction(e,t){var i;null===(i=this._instance)||void 0===i||i.moveOutWithDefaultAction(e,t)}getHandler(e){return e?this._onFocusIn:this._onFocusOut}setTabbable(e){var t;null===(t=this._instance)||void 0===t||t.setTabbable(this,e)}dispose(){this._instance&&(this._instance.dispose(this),delete this._instance),delete this._onFocusIn,delete this._onFocusOut}static moveWithPhantomDummy(e,t,i,s,r){var n;let l=new DummyInput(e.getWindow,!0,{isPhantom:!0,isFirst:!0}),a=l.input;if(a){let l,u;if("BODY"===t.tagName)l=t,u=i&&s||!i&&!s?y.getFirstElementChild(t):null;else{let o,r;i&&(!s||s&&!e.focusable.isFocusable(t,!1,!0,!0))?(l=t,u=s?t.firstElementChild:null):(l=y.getParentElement(t),u=i&&s||!i&&!s?t:y.getNextElementSibling(t));do(r=null===(n=null==(o=i&&s||!i&&!s?y.getPreviousElementSibling(u):u)?void 0:o.__tabsterDummyContainer)||void 0===n?void 0:n.get())===t?u=i&&s||!i&&!s?o:y.getNextElementSibling(o):r=void 0;while(r)}(null==l?void 0:l.dispatchEvent(new TabsterMoveFocusEvent({by:"root",owner:l,next:null,relatedEvent:r})))&&(y.insertBefore(l,a,u),(0,o.ev)(a))}}static addPhantomDummyWithTarget(e,t,i,s){let o=new DummyInput(e.getWindow,!0,{isPhantom:!0,isFirst:!0},void 0,new WeakHTMLElement(e.getWindow,s)),r=o.input;if(r){let e,s;!t.querySelector(l)||i?(e=y.getParentElement(t),s=i?t:y.getNextElementSibling(t)):(e=t,s=y.getFirstElementChild(t)),e&&y.insertBefore(e,r,s)}}};let DummyInputObserver=class DummyInputObserver{constructor(e){this._updateQueue=new Set,this._lastUpdateQueueTime=0,this._changedParents=new WeakSet,this._dummyElements=[],this._dummyCallbacks=new WeakMap,this._domChanged=e=>{var t;!this._changedParents.has(e)&&(this._changedParents.add(e),this._updateDummyInputsTimer||(this._updateDummyInputsTimer=null===(t=this._win)||void 0===t?void 0:t.call(this).setTimeout(()=>{for(let e of(delete this._updateDummyInputsTimer,this._dummyElements)){let t=e.get();if(t){let e=this._dummyCallbacks.get(t);if(e){let i=y.getParentNode(t);(!i||this._changedParents.has(i))&&e()}}}this._changedParents=new WeakSet},100)))},this._win=e}add(e,t){!this._dummyCallbacks.has(e)&&this._win&&(this._dummyElements.push(new WeakHTMLElement(this._win,e)),this._dummyCallbacks.set(e,t),this.domChanged=this._domChanged)}remove(e){this._dummyElements=this._dummyElements.filter(t=>{let i=t.get();return i&&i!==e}),this._dummyCallbacks.delete(e),0===this._dummyElements.length&&delete this.domChanged}dispose(){var e;let t=null===(e=this._win)||void 0===e?void 0:e.call(this);this._updateTimer&&(null==t||t.clearTimeout(this._updateTimer),delete this._updateTimer),this._updateDummyInputsTimer&&(null==t||t.clearTimeout(this._updateDummyInputsTimer),delete this._updateDummyInputsTimer),this._changedParents=new WeakSet,this._dummyCallbacks=new WeakMap,this._dummyElements=[],this._updateQueue.clear(),delete this.domChanged,delete this._win}updatePositions(e){this._win&&(this._updateQueue.add(e),this._lastUpdateQueueTime=Date.now(),this._scheduledUpdatePositions())}_scheduledUpdatePositions(){var e;this._updateTimer||(this._updateTimer=null===(e=this._win)||void 0===e?void 0:e.call(this).setTimeout(()=>{if(delete this._updateTimer,this._lastUpdateQueueTime+100<=Date.now()){let e=new Map,t=[];for(let i of this._updateQueue)t.push(i(e));for(let e of(this._updateQueue.clear(),t))e();e.clear()}else this._scheduledUpdatePositions()},100))}};let DummyInputManagerCore=class DummyInputManagerCore{constructor(e,t,i,s,r,n,l){this._wrappers=[],this._isOutside=!1,this._transformElements=new Set,this._onFocusIn=(e,t,i)=>{this._onFocus(!0,e,t,i)},this._onFocusOut=(e,t,i)=>{this._onFocus(!1,e,t,i)},this.moveOut=e=>{var t;let i=this._firstDummy,s=this._lastDummy;if(i&&s){this._ensurePosition();let r=i.input,n=s.input,l=null===(t=this._element)||void 0===t?void 0:t.get();if(r&&n&&l){let t;e?(r.tabIndex=0,t=r):(n.tabIndex=0,t=n),t&&(0,o.ev)(t)}}},this.moveOutWithDefaultAction=(e,t)=>{var i;let s=this._firstDummy,r=this._lastDummy;if(s&&r){this._ensurePosition();let n=s.input,l=r.input,a=null===(i=this._element)||void 0===i?void 0:i.get();if(n&&l&&a){let i;e?!s.isOutside&&this._tabster.focusable.isFocusable(a,!0,!0,!0)?i=a:(s.useDefaultAction=!0,n.tabIndex=0,i=n):(r.useDefaultAction=!0,l.tabIndex=0,i=l),i&&a.dispatchEvent(new TabsterMoveFocusEvent({by:"root",owner:a,next:null,relatedEvent:t}))&&(0,o.ev)(i)}}},this.setTabbable=(e,t)=>{var i,s;for(let i of this._wrappers)if(i.manager===e){i.tabbable=t;break}let o=this._getCurrent();if(o){let e=o.tabbable?0:-1,t=null===(i=this._firstDummy)||void 0===i?void 0:i.input;t&&(t.tabIndex=e),(t=null===(s=this._lastDummy)||void 0===s?void 0:s.input)&&(t.tabIndex=e)}},this._addDummyInputs=()=>{this._addTimer||(this._addTimer=this._getWindow().setTimeout(()=>{delete this._addTimer,this._ensurePosition(),this._addTransformOffsets()},0))},this._addTransformOffsets=()=>{this._tabster._dummyObserver.updatePositions(this._computeTransformOffsets)},this._computeTransformOffsets=e=>{var t,i;let s=(null===(t=this._firstDummy)||void 0===t?void 0:t.input)||(null===(i=this._lastDummy)||void 0===i?void 0:i.input),o=this._transformElements,r=new Set,n=0,l=0,a=this._getWindow();for(let t=s;t&&t.nodeType===Node.ELEMENT_NODE;t=y.getParentElement(t)){let i=e.get(t);if(void 0===i){let s=a.getComputedStyle(t).transform;s&&"none"!==s&&(i={scrollTop:t.scrollTop,scrollLeft:t.scrollLeft}),e.set(t,i||null)}i&&(r.add(t),o.has(t)||t.addEventListener("scroll",this._addTransformOffsets),n+=i.scrollTop,l+=i.scrollLeft)}for(let e of o)r.has(e)||e.removeEventListener("scroll",this._addTransformOffsets);return this._transformElements=r,()=>{var e,t;null===(e=this._firstDummy)||void 0===e||e.setTopLeft(n,l),null===(t=this._lastDummy)||void 0===t||t.setTopLeft(n,l)}};let a=t.get();if(!a)throw Error("No element");this._tabster=e,this._getWindow=e.getWindow,this._callForDefaultAction=l;let u=a.__tabsterDummy;if((u||this)._wrappers.push({manager:i,priority:s,tabbable:!0}),u)return u;a.__tabsterDummy=this;let d=null==r?void 0:r.dummyInputsPosition,c=a.tagName;this._isOutside=d?d===v.Outside:(n||"UL"===c||"OL"===c||"TABLE"===c)&&!("LI"===c||"TD"===c||"TH"===c),this._firstDummy=new DummyInput(this._getWindow,this._isOutside,{isFirst:!0},t),this._lastDummy=new DummyInput(this._getWindow,this._isOutside,{isFirst:!1},t);let h=this._firstDummy.input;h&&e._dummyObserver.add(h,this._addDummyInputs),this._firstDummy.onFocusIn=this._onFocusIn,this._firstDummy.onFocusOut=this._onFocusOut,this._lastDummy.onFocusIn=this._onFocusIn,this._lastDummy.onFocusOut=this._onFocusOut,this._element=t,this._addDummyInputs()}dispose(e,t){var i,s,o,r;let n=this._wrappers=this._wrappers.filter(i=>i.manager!==e&&!t);if(0===n.length){for(let e of(delete(null===(i=this._element)||void 0===i?void 0:i.get()).__tabsterDummy,this._transformElements))e.removeEventListener("scroll",this._addTransformOffsets);this._transformElements.clear();let e=this._getWindow();this._addTimer&&(e.clearTimeout(this._addTimer),delete this._addTimer);let t=null===(s=this._firstDummy)||void 0===s?void 0:s.input;t&&this._tabster._dummyObserver.remove(t),null===(o=this._firstDummy)||void 0===o||o.dispose(),null===(r=this._lastDummy)||void 0===r||r.dispose()}}_onFocus(e,t,i,s){var o;let r=this._getCurrent();r&&(!t.useDefaultAction||this._callForDefaultAction)&&(null===(o=r.manager.getHandler(e))||void 0===o||o(t,i,s))}_getCurrent(){return this._wrappers.sort((e,t)=>e.tabbable!==t.tabbable?e.tabbable?-1:1:e.priority-t.priority),this._wrappers[0]}_ensurePosition(){var e,t,i;let s=null===(e=this._element)||void 0===e?void 0:e.get(),o=null===(t=this._firstDummy)||void 0===t?void 0:t.input,r=null===(i=this._lastDummy)||void 0===i?void 0:i.input;if(s&&o&&r){if(this._isOutside){let e=y.getParentNode(s);if(e){let t=y.getNextSibling(s);t!==r&&y.insertBefore(e,r,t),y.getPreviousElementSibling(s)!==o&&y.insertBefore(e,o,s)}}else{y.getLastElementChild(s)!==r&&y.appendChild(s,r);let e=y.getFirstElementChild(s);e&&e!==o&&e.parentNode&&y.insertBefore(e.parentNode,o,e)}}}};function getLastChild$2(e){let t=null;for(let i=y.getLastElementChild(e);i;i=y.getLastElementChild(i))t=i;return t||void 0}function augmentAttribute(e,t,i,s){let o=e.storageEntry(t,!0),r=!1;if(!o.aug){if(void 0===s)return r;o.aug={}}if(void 0===s){if(i in o.aug){let e=o.aug[i];delete o.aug[i],null===e?t.removeAttribute(i):t.setAttribute(i,e),r=!0}}else{let e;i in o.aug||(e=t.getAttribute(i)),void 0!==e&&e!==s&&(o.aug[i]=e,null===s?t.removeAttribute(i):t.setAttribute(i,s),r=!0)}return void 0===s&&0===Object.keys(o.aug).length&&(delete o.aug,e.storageEntry(t,!1)),r}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */function getTabsterAttribute(e,t){let i=JSON.stringify(e);return!0===t?i:{[r]:i}}let RootDummyManager=class RootDummyManager extends DummyInputManager{constructor(e,t,i,s){super(e,t,1,s,void 0,!0),this._onDummyInputFocus=e=>{var t;if(e.useDefaultAction)this._setFocused(!1);else{this._tabster.keyboardNavigation.setNavigatingWithKeyboard(!0);let i=this._element.get();if(i){this._setFocused(!0);let t=this._tabster.focusedElement.getFirstOrLastTabbable(e.isFirst,{container:i,ignoreAccessibility:!0});if(t){(0,o.ev)(t);return}}null===(t=e.input)||void 0===t||t.blur()}},this._setHandlers(this._onDummyInputFocus),this._tabster=e,this._setFocused=i}};let Root=class Root extends TabsterPart{constructor(e,t,i,s,r){super(e,t,s),this._isFocused=!1,this._setFocused=e=>{var t;if(this._setFocusedTimer&&(this._tabster.getWindow().clearTimeout(this._setFocusedTimer),delete this._setFocusedTimer),this._isFocused===e)return;let i=this._element.get();i&&(e?(this._isFocused=!0,null===(t=this._dummyManager)||void 0===t||t.setTabbable(!1),i.dispatchEvent(new RootFocusEvent({element:i}))):this._setFocusedTimer=this._tabster.getWindow().setTimeout(()=>{var e;delete this._setFocusedTimer,this._isFocused=!1,null===(e=this._dummyManager)||void 0===e||e.setTabbable(!0),i.dispatchEvent(new RootBlurEvent({element:i}))},0))},this._onFocusIn=e=>{let t=this._tabster.getParent,i=this._element.get(),s=e.composedPath()[0];do{if(s===i){this._setFocused(!0);return}s=s&&t(s)}while(s)},this._onFocusOut=()=>{this._setFocused(!1)},this._onDispose=i;let n=e.getWindow;this.uid=getElementUId(n,t),this._sys=r,(e.controlTab||e.rootDummyInputs)&&this.addDummyInputs();let l=n(),a=l.document;a.addEventListener(o.PW,this._onFocusIn),a.addEventListener(o.r$,this._onFocusOut),this._add()}addDummyInputs(){this._dummyManager||(this._dummyManager=new RootDummyManager(this._tabster,this._element,this._setFocused,this._sys))}dispose(){var e;this._onDispose(this);let t=this._tabster.getWindow(),i=t.document;i.removeEventListener(o.PW,this._onFocusIn),i.removeEventListener(o.r$,this._onFocusOut),this._setFocusedTimer&&(t.clearTimeout(this._setFocusedTimer),delete this._setFocusedTimer),null===(e=this._dummyManager)||void 0===e||e.dispose(),this._remove()}moveOutWithDefaultAction(e,t){let i=this._dummyManager;if(i)i.moveOutWithDefaultAction(e,t);else{let i=this.getElement();i&&RootDummyManager.moveWithPhantomDummy(this._tabster,i,!0,e,t)}}_add(){}_remove(){}};let RootAPI=class RootAPI{constructor(e,t){this._autoRootWaiting=!1,this._roots={},this._forceDummy=!1,this.rootById={},this._autoRootCreate=()=>{var e;let t=this._win().document,i=t.body;if(i){this._autoRootUnwait(t);let s=this._autoRoot;if(s)return function(e,t,i){let s;if(i){let t=e.getAttribute(r);if(t)try{s=JSON.parse(t)}catch(e){}}s||(s={}),function(e,t){for(let i of Object.keys(t)){let s=t[i];s?e[i]=s:delete e[i]}}(s,t),Object.keys(s).length>0?e.setAttribute(r,getTabsterAttribute(s,!0)):e.removeAttribute(r)}(i,{root:s},!0),updateTabsterByAttribute(this._tabster,i),null===(e=getTabsterOnElement(this._tabster,i))||void 0===e?void 0:e.root}else this._autoRootWaiting||(this._autoRootWaiting=!0,t.addEventListener("readystatechange",this._autoRootCreate))},this._onRootDispose=e=>{delete this._roots[e.id]},this._tabster=e,this._win=e.getWindow,this._autoRoot=t,e.queueInit(()=>{this._autoRoot&&this._autoRootCreate()})}_autoRootUnwait(e){e.removeEventListener("readystatechange",this._autoRootCreate),this._autoRootWaiting=!1}dispose(){let e=this._win();this._autoRootUnwait(e.document),delete this._autoRoot,Object.keys(this._roots).forEach(e=>{this._roots[e]&&(this._roots[e].dispose(),delete this._roots[e])}),this.rootById={}}createRoot(e,t,i){let s=new Root(this._tabster,e,this._onRootDispose,t,i);return this._roots[s.id]=s,this._forceDummy&&s.addDummyInputs(),s}addDummyInputs(){this._forceDummy=!0;let e=this._roots;for(let t of Object.keys(e))e[t].addDummyInputs()}static getRootByUId(e,t){let i=e().__tabsterInstance;return i&&i.root.rootById[t]}static getTabsterContext(e,t,i){var s,o,r,n;let l,a,u,d,c,h,m,_;if(void 0===i&&(i={}),!t.ownerDocument)return;let{checkRtl:v,referenceElement:b}=i,f=e.getParent;e.drainInitQueue();let p=!1,g=b||t,E={};for(;g&&(!l||v);){let i=getTabsterOnElement(e,g);if(v&&void 0===m){let e=g.dir;e&&(m="rtl"===e.toLowerCase())}if(!i){g=f(g);continue}let n=g.tagName;(i.uncontrolled||"IFRAME"===n||"WEBVIEW"===n)&&(_=g),!d&&(null===(s=i.focusable)||void 0===s?void 0:s.excludeFromMover)&&!u&&(p=!0);let b=i.modalizer,T=i.groupper,y=i.mover;!a&&b&&(a=b),!u&&T&&(!a||b)&&(a?(!T.isActive()&&T.getProps().tabbability&&a.userId!==(null===(o=e.modalizer)||void 0===o?void 0:o.activeId)&&(a=void 0,u=T),h=T):u=T),d||!y||a&&!b||T&&g===t||(d=y,c=!!u&&u!==T),i.root&&(l=i.root),(null===(r=i.focusable)||void 0===r?void 0:r.ignoreKeydown)&&Object.assign(E,i.focusable.ignoreKeydown),g=f(g)}if(!l){let i=e.root,s=i._autoRoot;s&&(null===(n=t.ownerDocument)||void 0===n?void 0:n.body)&&(l=i._autoRootCreate())}return u&&!d&&(c=!0),l?{root:l,modalizer:a,groupper:u,mover:d,groupperBeforeMover:c,modalizerInGroupper:h,rtl:v?!!m:void 0,uncontrolled:_,excludedFromMover:p,ignoreKeydown:e=>!!E[e.key]}:void 0}static getRoot(e,t){var i;let s=e.getParent;for(let o=t;o;o=s(o)){let t=null===(i=getTabsterOnElement(e,o))||void 0===i?void 0:i.root;if(t)return t}}onRoot(e,t){t?delete this.rootById[e.uid]:this.rootById[e.uid]=e}};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */let Subscribable=class Subscribable{constructor(){this._callbacks=[]}dispose(){this._callbacks=[],delete this._val}subscribe(e){let t=this._callbacks,i=t.indexOf(e);i<0&&t.push(e)}subscribeFirst(e){let t=this._callbacks,i=t.indexOf(e);i>=0&&t.splice(i,1),t.unshift(e)}unsubscribe(e){let t=this._callbacks.indexOf(e);t>=0&&this._callbacks.splice(t,1)}setVal(e,t){this._val!==e&&(this._val=e,this._callCallbacks(e,t))}getVal(){return this._val}trigger(e,t){this._callCallbacks(e,t)}_callCallbacks(e,t){this._callbacks.forEach(i=>i(e,t))}};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */let FocusableAPI=class FocusableAPI{constructor(e){this._tabster=e}dispose(){}getProps(e){let t=getTabsterOnElement(this._tabster,e);return t&&t.focusable||{}}isFocusable(e,t,i,s){return!!matchesSelector(e,l)&&(!!t||-1!==e.tabIndex)&&(i||this.isVisible(e))&&(s||this.isAccessible(e))}isVisible(e){if(!e.ownerDocument||e.nodeType!==Node.ELEMENT_NODE||function(e){var t,i;let s=e.ownerDocument,o=null===(t=s.defaultView)||void 0===t?void 0:t.getComputedStyle(e);return null===e.offsetParent&&s.body!==e&&(null==o?void 0:o.position)!=="fixed"||(null==o?void 0:o.visibility)==="hidden"||(null==o?void 0:o.position)==="fixed"&&("none"===o.display||(null===(i=e.parentElement)||void 0===i?void 0:i.offsetParent)===null&&s.body!==e.parentElement)}(e))return!1;let t=e.ownerDocument.body.getBoundingClientRect();return 0!==t.width||0!==t.height}isAccessible(e){var t;for(let i=e;i;i=y.getParentElement(i)){let e=getTabsterOnElement(this._tabster,i);if(this._isHidden(i))return!1;let s=null===(t=null==e?void 0:e.focusable)||void 0===t?void 0:t.ignoreAriaDisabled;if(!s&&this._isDisabled(i))return!1}return!0}_isDisabled(e){return e.hasAttribute("disabled")}_isHidden(e){var t;let i=e.getAttribute("aria-hidden");return!(!i||"true"!==i.toLowerCase()||(null===(t=this._tabster.modalizer)||void 0===t?void 0:t.isAugmented(e)))}findFirst(e,t){return this.findElement({...e},t)}findLast(e,t){return this.findElement({isBackward:!0,...e},t)}findNext(e,t){return this.findElement({...e},t)}findPrev(e,t){return this.findElement({...e,isBackward:!0},t)}findDefault(e,t){return this.findElement({...e,acceptCondition:t=>this.isFocusable(t,e.includeProgrammaticallyFocusable)&&!!this.getProps(t).isDefault},t)||null}findAll(e){return this._findElements(!0,e)||[]}findElement(e,t){let i=this._findElements(!1,e,t);return i?i[0]:i}_findElements(e,t,i){var s,o,r;let{container:n,currentElement:l=null,includeProgrammaticallyFocusable:a,useActiveModalizer:u,ignoreAccessibility:d,modalizerId:c,isBackward:h,onElement:m}=t;i||(i={});let _=[],{acceptCondition:v}=t,b=!!v;if(!n)return null;v||(v=e=>this.isFocusable(e,a,!1,d));let f={container:n,modalizerUserId:void 0===c&&u?null===(s=this._tabster.modalizer)||void 0===s?void 0:s.activeId:c||(null===(r=null===(o=RootAPI.getTabsterContext(this._tabster,n))||void 0===o?void 0:o.modalizer)||void 0===r?void 0:r.userId),from:l||n,isBackward:h,acceptCondition:v,hasCustomCondition:b,includeProgrammaticallyFocusable:a,ignoreAccessibility:d,cachedGrouppers:{}},p=createElementTreeWalker(n.ownerDocument,n,e=>this._acceptElement(e,f));if(!p)return null;let prepareForNextElement=t=>{var s,o;let r=null!==(s=f.foundElement)&&void 0!==s?s:f.foundBackward;return(r&&_.push(r),e)?(!r||(f.found=!1,delete f.foundElement,delete f.foundBackward,delete f.fromCtx,f.from=r,!m||!!m(r)))&&!!(r||t):(r&&i&&(i.uncontrolled=null===(o=RootAPI.getTabsterContext(this._tabster,r))||void 0===o?void 0:o.uncontrolled),!!(t&&!r))};if(l||(i.outOfDOMOrder=!0),l&&y.nodeContains(n,l))p.currentNode=l;else if(h){let e=getLastChild$2(n);if(!e)return null;if(this._acceptElement(e,f)===NodeFilter.FILTER_ACCEPT&&!prepareForNextElement(!0))return f.skippedFocusable&&(i.outOfDOMOrder=!0),_;p.currentNode=e}do h?p.previousNode():p.nextNode();while(prepareForNextElement());return f.skippedFocusable&&(i.outOfDOMOrder=!0),_.length?_:null}_acceptElement(e,t){var i,s,o;let r;if(t.found)return NodeFilter.FILTER_ACCEPT;let n=t.foundBackward;if(n&&(e===n||!y.nodeContains(n,e)))return t.found=!0,t.foundElement=n,NodeFilter.FILTER_ACCEPT;let l=t.container;if(e===l)return NodeFilter.FILTER_SKIP;if(!y.nodeContains(l,e)||e.__tabsterDummyContainer||y.nodeContains(t.rejectElementsFrom,e))return NodeFilter.FILTER_REJECT;let a=t.currentCtx=RootAPI.getTabsterContext(this._tabster,e);if(!a)return NodeFilter.FILTER_SKIP;if(shouldIgnoreFocus(e))return this.isFocusable(e,void 0,!0,!0)&&(t.skippedFocusable=!0),NodeFilter.FILTER_SKIP;if(!t.hasCustomCondition&&("IFRAME"===e.tagName||"WEBVIEW"===e.tagName))return(null===(i=a.modalizer)||void 0===i?void 0:i.userId)===(null===(s=this._tabster.modalizer)||void 0===s?void 0:s.activeId)?(t.found=!0,t.rejectElementsFrom=t.foundElement=e,NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_REJECT;if(!t.ignoreAccessibility&&!this.isAccessible(e))return this.isFocusable(e,!1,!0,!0)&&(t.skippedFocusable=!0),NodeFilter.FILTER_REJECT;let u=t.fromCtx;u||(u=t.fromCtx=RootAPI.getTabsterContext(this._tabster,t.from));let d=null==u?void 0:u.mover,c=a.groupper,h=a.mover;if(void 0!==(r=null===(o=this._tabster.modalizer)||void 0===o?void 0:o.acceptElement(e,t))&&(t.skippedFocusable=!0),void 0===r&&(c||h||d)){let i=null==c?void 0:c.getElement(),s=null==d?void 0:d.getElement(),o=null==h?void 0:h.getElement();o&&y.nodeContains(s,o)&&y.nodeContains(l,s)&&(!i||!h||y.nodeContains(s,i))&&(h=d,o=s),i&&(i===l||!y.nodeContains(l,i))&&(c=void 0),o&&!y.nodeContains(l,o)&&(h=void 0),c&&h&&(o&&i&&!y.nodeContains(i,o)?h=void 0:c=void 0),c&&(r=c.acceptElement(e,t)),h&&(r=h.acceptElement(e,t))}return void 0===r&&(r=t.acceptCondition(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP)===NodeFilter.FILTER_SKIP&&this.isFocusable(e,!1,!0,!0)&&(t.skippedFocusable=!0),r!==NodeFilter.FILTER_ACCEPT||t.found||(t.isBackward?(t.foundBackward=e,r=NodeFilter.FILTER_SKIP):(t.found=!0,t.foundElement=e)),r}};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */let C={Tab:"Tab",Enter:"Enter",Escape:"Escape",PageUp:"PageUp",PageDown:"PageDown",End:"End",Home:"Home",ArrowLeft:"ArrowLeft",ArrowUp:"ArrowUp",ArrowRight:"ArrowRight",ArrowDown:"ArrowDown"},k={[a.Restorer]:0,[a.Deloser]:1,[a.EscapeGroupper]:2};let FocusedElementState=class FocusedElementState extends Subscribable{constructor(e,t){super(),this._init=()=>{let e=this._win(),t=e.document;t.addEventListener(o.PW,this._onFocusIn,!0),t.addEventListener(o.r$,this._onFocusOut,!0),e.addEventListener("keydown",this._onKeyDown,!0);let i=y.getActiveElement(t);i&&i!==t.body&&this._setFocusedElement(i),this.subscribe(this._onChanged)},this._onFocusIn=e=>{let t=e.composedPath()[0];t&&this._setFocusedElement(t,e.detail.relatedTarget,e.detail.isFocusedProgrammatically)},this._onFocusOut=e=>{var t;this._setFocusedElement(void 0,null===(t=e.detail)||void 0===t?void 0:t.originalEvent.relatedTarget)},this._validateFocusedElement=e=>{},this._onKeyDown=e=>{if(e.key!==C.Tab||e.ctrlKey)return;let t=this.getVal();if(!t||!t.ownerDocument||"true"===t.contentEditable)return;let i=this._tabster,s=i.controlTab,r=RootAPI.getTabsterContext(i,t);if(!r||r.ignoreKeydown(e))return;let n=e.shiftKey,l=FocusedElementState.findNextTabbable(i,r,void 0,t,void 0,n,!0),a=r.root.getElement();if(!a)return;let u=null==l?void 0:l.element,d=/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */function(e,t){var i;let s=e.getParent,o=t;do{let t=null===(i=getTabsterOnElement(e,o))||void 0===i?void 0:i.uncontrolled;if(t&&e.uncontrolled.isUncontrolledCompletely(o,!!t.completely))return o;o=s(o)}while(o)}(i,t);if(u){let c=l.uncontrolled;if(r.uncontrolled||y.nodeContains(c,t)){if(!l.outOfDOMOrder&&c===r.uncontrolled||d&&!y.nodeContains(d,u))return;DummyInputManager.addPhantomDummyWithTarget(i,t,n,u);return}if(c||"IFRAME"===u.tagName){a.dispatchEvent(new TabsterMoveFocusEvent({by:"root",owner:a,next:u,relatedEvent:e}))&&DummyInputManager.moveWithPhantomDummy(this._tabster,null!=c?c:u,!1,n,e);return}(s||(null==l?void 0:l.outOfDOMOrder))&&a.dispatchEvent(new TabsterMoveFocusEvent({by:"root",owner:a,next:u,relatedEvent:e}))&&(e.preventDefault(),e.stopImmediatePropagation(),(0,o.ev)(u))}else!d&&a.dispatchEvent(new TabsterMoveFocusEvent({by:"root",owner:a,next:null,relatedEvent:e}))&&r.root.moveOutWithDefaultAction(n,e)},this._onChanged=(e,t)=>{var i,s;if(e)e.dispatchEvent(new TabsterFocusInEvent(t));else{let e=null===(i=this._lastVal)||void 0===i?void 0:i.get();if(e){let i={...t},o=RootAPI.getTabsterContext(this._tabster,e),r=null===(s=null==o?void 0:o.modalizer)||void 0===s?void 0:s.userId;r&&(i.modalizerId=r),e.dispatchEvent(new TabsterFocusOutEvent(i))}}},this._tabster=e,this._win=t,e.queueInit(this._init)}dispose(){super.dispose();let e=this._win(),t=e.document;t.removeEventListener(o.PW,this._onFocusIn,!0),t.removeEventListener(o.r$,this._onFocusOut,!0),e.removeEventListener("keydown",this._onKeyDown,!0),this.unsubscribe(this._onChanged);let i=this._asyncFocus;i&&(e.clearTimeout(i.timeout),delete this._asyncFocus),delete FocusedElementState._lastResetElement,delete this._nextVal,delete this._lastVal}static forgetMemorized(e,t){var i,s;let o=FocusedElementState._lastResetElement,r=o&&o.get();r&&y.nodeContains(t,r)&&delete FocusedElementState._lastResetElement,(r=null===(s=null===(i=e._nextVal)||void 0===i?void 0:i.element)||void 0===s?void 0:s.get())&&y.nodeContains(t,r)&&delete e._nextVal,(r=(o=e._lastVal)&&o.get())&&y.nodeContains(t,r)&&delete e._lastVal}getFocusedElement(){return this.getVal()}getLastFocusedElement(){var e;let t=null===(e=this._lastVal)||void 0===e?void 0:e.get();return t&&(!t||documentContains(t.ownerDocument,t))||(this._lastVal=t=void 0),t}focus(e,t,i){return!!this._tabster.focusable.isFocusable(e,t,!1,i)&&(e.focus(),!0)}focusDefault(e){let t=this._tabster.focusable.findDefault({container:e});return!!t&&(this._tabster.focusedElement.focus(t),!0)}getFirstOrLastTabbable(e,t){var i;let s;let{container:o,ignoreAccessibility:r}=t;if(o){let t=RootAPI.getTabsterContext(this._tabster,o);t&&(s=null===(i=FocusedElementState.findNextTabbable(this._tabster,t,o,void 0,void 0,!e,r))||void 0===i?void 0:i.element)}return s&&!y.nodeContains(o,s)&&(s=void 0),s||void 0}_focusFirstOrLast(e,t){let i=this.getFirstOrLastTabbable(e,t);return!!i&&(this.focus(i,!1,!0),!0)}focusFirst(e){return this._focusFirstOrLast(!0,e)}focusLast(e){return this._focusFirstOrLast(!1,e)}resetFocus(e){if(!this._tabster.focusable.isVisible(e))return!1;if(this._tabster.focusable.isFocusable(e,!0,!0,!0))this.focus(e);else{let t=e.getAttribute("tabindex"),i=e.getAttribute("aria-hidden");e.tabIndex=-1,e.setAttribute("aria-hidden","true"),FocusedElementState._lastResetElement=new WeakHTMLElement(this._win,e),this.focus(e,!0,!0),this._setOrRemoveAttribute(e,"tabindex",t),this._setOrRemoveAttribute(e,"aria-hidden",i)}return!0}requestAsyncFocus(e,t,i){let s=this._tabster.getWindow(),o=this._asyncFocus;if(o){if(k[e]>k[o.source])return;s.clearTimeout(o.timeout)}this._asyncFocus={source:e,callback:t,timeout:s.setTimeout(()=>{this._asyncFocus=void 0,t()},i)}}cancelAsyncFocus(e){let t=this._asyncFocus;(null==t?void 0:t.source)===e&&(this._tabster.getWindow().clearTimeout(t.timeout),this._asyncFocus=void 0)}_setOrRemoveAttribute(e,t,i){null===i?e.removeAttribute(t):e.setAttribute(t,i)}_setFocusedElement(e,t,i){var s,o;if(this._tabster._noop)return;let r={relatedTarget:t};if(e){let t=null===(s=FocusedElementState._lastResetElement)||void 0===s?void 0:s.get();if(FocusedElementState._lastResetElement=void 0,t===e||shouldIgnoreFocus(e))return;r.isFocusedProgrammatically=i;let n=RootAPI.getTabsterContext(this._tabster,e),l=null===(o=null==n?void 0:n.modalizer)||void 0===o?void 0:o.userId;l&&(r.modalizerId=l)}let n=this._nextVal={element:e?new WeakHTMLElement(this._win,e):void 0,detail:r};e&&e!==this._val&&this._validateFocusedElement(e),this._nextVal===n&&this.setVal(e,r),this._nextVal=void 0}setVal(e,t){super.setVal(e,t),e&&(this._lastVal=new WeakHTMLElement(this._win,e))}static findNextTabbable(e,t,i,s,o,r,n){let l=i||t.root.getElement();if(!l)return null;let a=null,u=FocusedElementState._isTabbingTimer,d=e.getWindow();u&&d.clearTimeout(u),FocusedElementState.isTabbing=!0,FocusedElementState._isTabbingTimer=d.setTimeout(()=>{delete FocusedElementState._isTabbingTimer,FocusedElementState.isTabbing=!1},0);let c=t.modalizer,h=t.groupper,m=t.mover,callFindNext=t=>{if(a=t.findNextTabbable(s,o,r,n),s&&!(null==a?void 0:a.element)){let o=t!==c&&y.getParentElement(t.getElement());if(o){let l=RootAPI.getTabsterContext(e,s,{referenceElement:o});if(l){let s=t.getElement(),u=r?s:s&&getLastChild$2(s)||s;u&&(a=FocusedElementState.findNextTabbable(e,l,i,u,o,r,n))&&(a.outOfDOMOrder=!0)}}}};if(h&&m)callFindNext(t.groupperBeforeMover?h:m);else if(h)callFindNext(h);else if(m)callFindNext(m);else if(c)callFindNext(c);else{let t={},i=e.focusable[r?"findPrev":"findNext"]({container:l,currentElement:s,referenceElement:o,ignoreAccessibility:n,useActiveModalizer:!0},t);a={element:i,outOfDOMOrder:t.outOfDOMOrder,uncontrolled:t.uncontrolled}}return a}};FocusedElementState.isTabbing=!1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */let GroupperDummyManager=class GroupperDummyManager extends DummyInputManager{constructor(e,t,i,s){super(i,e,4,s,!0),this._setHandlers((s,r,n)=>{var l,a;let u=e.get(),d=s.input;if(u&&d){let e=RootAPI.getTabsterContext(i,d);if(e){let c;(c=null===(l=t.findNextTabbable(n||void 0,void 0,r,!0))||void 0===l?void 0:l.element)||(c=null===(a=FocusedElementState.findNextTabbable(i,e,void 0,s.isOutside?d:function(e,t){let i=e,s=null;for(;i&&!s;)s=t?y.getPreviousElementSibling(i):y.getNextElementSibling(i),i=y.getParentElement(i);return s||void 0}(u,!r),void 0,r,!0))||void 0===a?void 0:a.element),c&&(0,o.ev)(c)}}})}};let Groupper=class Groupper extends TabsterPart{constructor(e,t,i,s,o){super(e,t,s),this._shouldTabInside=!1,this.makeTabbable(!1),this._onDispose=i,e.controlTab||(this.dummyManager=new GroupperDummyManager(this._element,this,e,o))}dispose(){var e;this._onDispose(this),this._element.get(),null===(e=this.dummyManager)||void 0===e||e.dispose(),delete this.dummyManager,delete this._first}findNextTabbable(e,t,i,s){var o;let r;let n=this.getElement();if(!n)return null;let l=(null===(o=null==e?void 0:e.__tabsterDummyContainer)||void 0===o?void 0:o.get())===n;if(!this._shouldTabInside&&e&&y.nodeContains(n,e)&&!l)return{element:void 0,outOfDOMOrder:!0};let a=this.getFirst(!0);if(!e||!y.nodeContains(n,e)||l)return{element:a,outOfDOMOrder:!0};let u=this._tabster,d=null,c=!1;if(this._shouldTabInside&&a){let o={};d=u.focusable[i?"findPrev":"findNext"]({container:n,currentElement:e,referenceElement:t,ignoreAccessibility:s,useActiveModalizer:!0},o),c=!!o.outOfDOMOrder,d||this._props.tabbability!==m.LimitedTrapFocus||(d=u.focusable[i?"findLast":"findFirst"]({container:n,ignoreAccessibility:s,useActiveModalizer:!0},o),c=!0),r=o.uncontrolled}return{element:d,uncontrolled:r,outOfDOMOrder:c}}makeTabbable(e){this._shouldTabInside=e||!this._props.tabbability}isActive(e){var t;let i=this.getElement()||null,s=!0;for(let e=y.getParentElement(i);e;e=y.getParentElement(e)){let i=null===(t=getTabsterOnElement(this._tabster,e))||void 0===t?void 0:t.groupper;i&&!i._shouldTabInside&&(s=!1)}let o=s?!!this._props.tabbability&&this._shouldTabInside:void 0;if(o&&e){let e=this._tabster.focusedElement.getFocusedElement();e&&(o=e!==this.getFirst(!0))}return o}getFirst(e){var t;let i;let s=this.getElement();if(s){if(e&&this._tabster.focusable.isFocusable(s))return s;!(i=null===(t=this._first)||void 0===t?void 0:t.get())&&(i=this._tabster.focusable.findFirst({container:s,useActiveModalizer:!0})||void 0)&&this.setFirst(i)}return i}setFirst(e){e?this._first=new WeakHTMLElement(this._tabster.getWindow,e):delete this._first}acceptElement(e,t){let i;let s=t.cachedGrouppers,o=y.getParentElement(this.getElement()),r=o&&RootAPI.getTabsterContext(this._tabster,o),n=null==r?void 0:r.groupper,l=(null==r?void 0:r.groupperBeforeMover)?n:void 0,getIsActive=e=>{let t,i=s[e.id];return i?t=i.isActive:(t=this.isActive(!0),i=s[e.id]={isActive:t}),t};if(l&&(i=l.getElement(),!getIsActive(l)&&i&&t.container!==i&&y.nodeContains(t.container,i)))return t.skippedFocusable=!0,NodeFilter.FILTER_REJECT;let a=getIsActive(this),u=this.getElement();if(u&&!0!==a){let o;if(u===e&&n&&(i||(i=n.getElement()),i&&!getIsActive(n)&&y.nodeContains(t.container,i)&&i!==t.container)||u!==e&&y.nodeContains(u,e))return t.skippedFocusable=!0,NodeFilter.FILTER_REJECT;let r=s[this.id];if((o="first"in r?r.first:r.first=this.getFirst(!0))&&t.acceptCondition(o))return(t.rejectElementsFrom=u,t.skippedFocusable=!0,o!==t.from)?(t.found=!0,t.foundElement=o,NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_REJECT}}};let GroupperAPI=class GroupperAPI{constructor(e,t){this._current={},this._grouppers={},this._init=()=>{let e=this._win();this._tabster.focusedElement.subscribeFirst(this._onFocus);let t=e.document,i=y.getActiveElement(t);i&&this._onFocus(i),t.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("keydown",this._onKeyDown,!0),e.addEventListener(g,this._onMoveFocus)},this._onGroupperDispose=e=>{delete this._grouppers[e.id]},this._onFocus=e=>{e&&this._updateCurrent(e,!0,!0)},this._onMouseDown=e=>{e.target&&this._updateCurrent(e.target,!0)},this._onKeyDown=e=>{if(e.key!==C.Enter&&e.key!==C.Escape||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)return;let t=this._tabster.focusedElement.getFocusedElement();t&&this.handleKeyPress(t,e)},this._onMoveFocus=e=>{var t;let i=e.composedPath()[0],s=null===(t=e.detail)||void 0===t?void 0:t.action;i&&void 0!==s&&!e.defaultPrevented&&(s===_.Enter?this._enterGroupper(i):this._escapeGroupper(i),e.stopImmediatePropagation())},this._tabster=e,this._win=t,e.queueInit(this._init)}dispose(){let e=this._win();this._tabster.focusedElement.cancelAsyncFocus(a.EscapeGroupper),this._current={},this._updateTimer&&(e.clearTimeout(this._updateTimer),delete this._updateTimer),this._tabster.focusedElement.unsubscribe(this._onFocus),e.document.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("keydown",this._onKeyDown,!0),e.removeEventListener(g,this._onMoveFocus),Object.keys(this._grouppers).forEach(e=>{this._grouppers[e]&&(this._grouppers[e].dispose(),delete this._grouppers[e])})}createGroupper(e,t,i){let s=new Groupper(this._tabster,e,this._onGroupperDispose,t,i);this._grouppers[s.id]=s;let o=this._tabster.focusedElement.getFocusedElement();return o&&y.nodeContains(e,o)&&!this._updateTimer&&(this._updateTimer=this._win().setTimeout(()=>{delete this._updateTimer,o===this._tabster.focusedElement.getFocusedElement()&&this._updateCurrent(o,!0,!0)},0)),s}forgetCurrentGrouppers(){this._current={}}_updateCurrent(e,t,i){var s;this._updateTimer&&(this._win().clearTimeout(this._updateTimer),delete this._updateTimer);let o={},r=!0;for(let n=e;n;n=y.getParentElement(n)){let l=null===(s=getTabsterOnElement(this._tabster,n))||void 0===s?void 0:s.groupper;if(l){if(o[l.id]=!0,r&&i&&n!==e&&(r=!1),t||!r){this._current[l.id]=l;let t=l.isActive()||e!==n&&(!l.getProps().delegated||l.getFirst(!1)!==e);l.makeTabbable(t)}r=!1}}for(let e of Object.keys(this._current)){let t=this._current[e];t.id in o||(t.makeTabbable(!1),t.setFirst(void 0),delete this._current[e])}}_enterGroupper(e,t){let i=this._tabster,s=RootAPI.getTabsterContext(i,e),o=(null==s?void 0:s.groupper)||(null==s?void 0:s.modalizerInGroupper),r=null==o?void 0:o.getElement();if(o&&r&&(e===r||o.getProps().delegated&&e===o.getFirst(!1))){let s=i.focusable.findNext({container:r,currentElement:e,useActiveModalizer:!0});if(s&&(!t||t&&r.dispatchEvent(new TabsterMoveFocusEvent({by:"groupper",owner:r,next:s,relatedEvent:t}))))return t&&(t.preventDefault(),t.stopImmediatePropagation()),s.focus(),s}return null}_escapeGroupper(e,t,i){var s;let o=this._tabster,r=RootAPI.getTabsterContext(o,e),n=null==r?void 0:r.modalizerInGroupper,l=(null==r?void 0:r.groupper)||n,a=null==l?void 0:l.getElement();if(l&&a&&y.nodeContains(a,e)){let r;if(e!==a||i)r=l.getFirst(!0);else{let e=y.getParentElement(a),t=e?RootAPI.getTabsterContext(o,e):void 0;r=null==(l=null==t?void 0:t.groupper)?void 0:l.getFirst(!0)}if(r&&(!t||t&&a.dispatchEvent(new TabsterMoveFocusEvent({by:"groupper",owner:a,next:r,relatedEvent:t}))))return l&&(l.makeTabbable(!1),n&&(null===(s=o.modalizer)||void 0===s||s.setActive(void 0))),r.focus(),r}return null}moveFocus(e,t){return t===_.Enter?this._enterGroupper(e):this._escapeGroupper(e)}handleKeyPress(e,t,i){let s=this._tabster,o=RootAPI.getTabsterContext(s,e);if(o&&((null==o?void 0:o.groupper)||(null==o?void 0:o.modalizerInGroupper))){if(s.focusedElement.cancelAsyncFocus(a.EscapeGroupper),o.ignoreKeydown(t))return;if(t.key===C.Enter)this._enterGroupper(e,t);else if(t.key===C.Escape){let o=s.focusedElement.getFocusedElement();s.focusedElement.requestAsyncFocus(a.EscapeGroupper,()=>{(o===s.focusedElement.getFocusedElement()||(!i||o)&&i)&&this._escapeGroupper(e,t,i)},0)}}}};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */let KeyboardNavigationState=class KeyboardNavigationState extends Subscribable{constructor(e){super(),this._onChange=e=>{this.setVal(e,void 0)},this._keyborg=(0,o.Vm)(e()),this._keyborg.subscribe(this._onChange)}dispose(){super.dispose(),this._keyborg&&(this._keyborg.unsubscribe(this._onChange),(0,o.ub)(this._keyborg),delete this._keyborg)}setNavigatingWithKeyboard(e){var t;null===(t=this._keyborg)||void 0===t||t.setVal(e)}isNavigatingWithKeyboard(){var e;return!!(null===(e=this._keyborg)||void 0===e?void 0:e.isNavigatingWithKeyboard())}};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */let A=0,M="aria-hidden";let ModalizerDummyManager=class ModalizerDummyManager extends DummyInputManager{constructor(e,t,i){super(t,e,2,i),this._setHandlers((i,s)=>{var r,n,l;let a;let u=e.get(),d=u&&(null===(r=RootAPI.getRoot(t,u))||void 0===r?void 0:r.getElement()),c=i.input;if(d&&c){let e=null===(n=c.__tabsterDummyContainer)||void 0===n?void 0:n.get(),i=RootAPI.getTabsterContext(t,e||c);i&&(a=null===(l=FocusedElementState.findNextTabbable(t,i,d,c,void 0,s,!0))||void 0===l?void 0:l.element),a&&(0,o.ev)(a)}})}};let Modalizer=class Modalizer extends TabsterPart{constructor(e,t,i,s,o,r){super(e,t,s),this._wasFocused=0,this.userId=s.id,this._onDispose=i,this._activeElements=r,e.controlTab||(this.dummyManager=new ModalizerDummyManager(this._element,e,o))}makeActive(e){if(this._isActive!==e){this._isActive=e;let t=this.getElement();if(t){let i=this._activeElements,s=i.map(e=>e.get()).indexOf(t);e?s<0&&i.push(new WeakHTMLElement(this._tabster.getWindow,t)):s>=0&&i.splice(s,1)}this._dispatchEvent(e)}}focused(e){return e||(this._wasFocused=++A),this._wasFocused}setProps(e){e.id&&(this.userId=e.id),this._props={...e}}dispose(){var e;this.makeActive(!1),this._onDispose(this),null===(e=this.dummyManager)||void 0===e||e.dispose(),delete this.dummyManager,this._activeElements=[],this._remove()}isActive(){return!!this._isActive}contains(e){return y.nodeContains(this.getElement(),e)}findNextTabbable(e,t,i,s){var o,r;let n;let l=this.getElement();if(!l)return null;let a=this._tabster,u=null,d=!1,c=e&&(null===(o=RootAPI.getRoot(a,e))||void 0===o?void 0:o.getElement());if(c){let o={};!(u=a.focusable[i?"findPrev":"findNext"]({container:c,currentElement:e,referenceElement:t,ignoreAccessibility:s,useActiveModalizer:!0},o))&&this._props.isTrapped&&(null===(r=a.modalizer)||void 0===r?void 0:r.activeId)?(u=a.focusable[i?"findLast":"findFirst"]({container:c,ignoreAccessibility:s,useActiveModalizer:!0},o),d=!0):d=!!o.outOfDOMOrder,n=o.uncontrolled}return{element:u,uncontrolled:n,outOfDOMOrder:d}}_dispatchEvent(e,t){let i=this.getElement(),s=!1;if(i){let o=t?this._activeElements.map(e=>e.get()):[i];for(let t of o)if(t){let o={id:this.userId,element:i},r=e?new ModalizerActiveEvent(o):new ModalizerInactiveEvent(o);t.dispatchEvent(r),r.defaultPrevented&&(s=!0)}}return s}_remove(){}};let ModalizerAPI=class ModalizerAPI{constructor(e,t,i){this._onModalizerDispose=e=>{let t=e.id,i=e.userId,s=this._parts[i];delete this._modalizers[t],s&&(delete s[t],0===Object.keys(s).length&&(delete this._parts[i],this.activeId===i&&this.setActive(void 0)))},this._onKeyDown=e=>{var t;if(e.key!==C.Escape)return;let i=this._tabster,s=i.focusedElement.getFocusedElement();if(s){let o=RootAPI.getTabsterContext(i,s),r=null==o?void 0:o.modalizer;if(o&&!o.groupper&&(null==r?void 0:r.isActive())&&!o.ignoreKeydown(e)){let s=r.userId;if(s){let o=this._parts[s];if(o){let s=Object.keys(o).map(e=>{var t;let i;let s=o[e],r=s.getElement();return r&&(i=null===(t=getTabsterOnElement(this._tabster,r))||void 0===t?void 0:t.groupper),s&&r&&i?{el:r,focusedSince:s.focused(!0)}:{focusedSince:0}}).filter(e=>e.focusedSince>0).sort((e,t)=>e.focusedSince>t.focusedSince?-1:e.focusedSince<t.focusedSince?1:0);if(s.length){let o=s[0].el;o&&(null===(t=i.groupper)||void 0===t||t.handleKeyPress(o,e,!0))}}}}}},this._onFocus=(e,t)=>{var i,s;let o=e&&RootAPI.getTabsterContext(this._tabster,e);if(!o||!e)return;let r=this._augMap;for(let t=e;t;t=y.getParentElement(t))r.has(t)&&(r.delete(t),augmentAttribute(this._tabster,t,M));let n=o.modalizer;if(null===(s=n||(null===(i=getTabsterOnElement(this._tabster,e))||void 0===i?void 0:i.modalizer))||void 0===s||s.focused(),(null==n?void 0:n.userId)===this.activeId){this.currentIsOthersAccessible=null==n?void 0:n.getProps().isOthersAccessible;return}if(t.isFocusedProgrammatically||this.currentIsOthersAccessible||(null==n?void 0:n.getProps().isAlwaysAccessible))this.setActive(n);else{let t=this._win();t.clearTimeout(this._restoreModalizerFocusTimer),this._restoreModalizerFocusTimer=t.setTimeout(()=>this._restoreModalizerFocus(e),100)}},this._tabster=e,this._win=e.getWindow,this._modalizers={},this._parts={},this._augMap=new WeakMap,this._aug=[],this._alwaysAccessibleSelector=t,this._accessibleCheck=i,this.activeElements=[],e.controlTab||e.root.addDummyInputs();let s=this._win();s.addEventListener("keydown",this._onKeyDown,!0),e.queueInit(()=>{this._tabster.focusedElement.subscribe(this._onFocus)})}dispose(){let e=this._win();e.removeEventListener("keydown",this._onKeyDown,!0),Object.keys(this._modalizers).forEach(e=>{this._modalizers[e]&&(this._modalizers[e].dispose(),delete this._modalizers[e])}),e.clearTimeout(this._restoreModalizerFocusTimer),e.clearTimeout(this._hiddenUpdateTimer),this._parts={},delete this.activeId,this.activeElements=[],this._augMap=new WeakMap,this._aug=[],this._tabster.focusedElement.unsubscribe(this._onFocus)}createModalizer(e,t,i){var s;let o=new Modalizer(this._tabster,e,this._onModalizerDispose,t,i,this.activeElements),r=o.id,n=t.id;this._modalizers[r]=o;let l=this._parts[n];return l||(l=this._parts[n]={}),l[r]=o,y.nodeContains(e,null!==(s=this._tabster.focusedElement.getFocusedElement())&&void 0!==s?s:null)&&(n!==this.activeId?this.setActive(o):o.makeActive(!0)),o}isAugmented(e){return this._augMap.has(e)}hiddenUpdate(){this._hiddenUpdateTimer||(this._hiddenUpdateTimer=this._win().setTimeout(()=>{delete this._hiddenUpdateTimer,this._hiddenUpdate()},250))}setActive(e){let t=null==e?void 0:e.userId,i=this.activeId;if(i!==t){if(this.activeId=t,i){let e=this._parts[i];if(e)for(let t of Object.keys(e))e[t].makeActive(!1)}if(t){let e=this._parts[t];if(e)for(let t of Object.keys(e))e[t].makeActive(!0)}this.currentIsOthersAccessible=null==e?void 0:e.getProps().isOthersAccessible,this.hiddenUpdate()}}focus(e,t,i){let s=RootAPI.getTabsterContext(this._tabster,e),o=null==s?void 0:s.modalizer;if(o){this.setActive(o);let e=o.getProps(),s=o.getElement();if(s){if(void 0===t&&(t=e.isNoFocusFirst),!t&&this._tabster.keyboardNavigation.isNavigatingWithKeyboard()&&this._tabster.focusedElement.focusFirst({container:s})||(void 0===i&&(i=e.isNoFocusDefault),!i&&this._tabster.focusedElement.focusDefault(s)))return!0;this._tabster.focusedElement.resetFocus(s)}}return!1}acceptElement(e,t){var i;let s=t.modalizerUserId,o=null===(i=t.currentCtx)||void 0===i?void 0:i.modalizer;if(s)for(let t of this.activeElements){let i=t.get();if(i&&(y.nodeContains(e,i)||i===e))return NodeFilter.FILTER_SKIP}let r=s===(null==o?void 0:o.userId)||!s&&(null==o?void 0:o.getProps().isAlwaysAccessible)?void 0:NodeFilter.FILTER_SKIP;return void 0!==r&&(t.skippedFocusable=!0),r}_hiddenUpdate(){var e;let t=this._tabster,i=t.getWindow().document.body,s=this.activeId,o=this._parts,r=[],n=[],l=this._alwaysAccessibleSelector,a=l?Array.from(y.querySelectorAll(i,l)):[],u=[];for(let e of Object.keys(o)){let t=o[e];for(let i of Object.keys(t)){let o=t[i],l=o.getElement(),d=o.getProps(),c=d.isAlwaysAccessible;l&&(e===s?(u.push(l),this.currentIsOthersAccessible||r.push(l)):c?a.push(l):n.push(l))}}let d=this._augMap,c=r.length>0?[...r,...a]:void 0,h=[],m=new WeakMap,toggle=(e,i)=>{var s;let o=e.tagName;if("SCRIPT"===o||"STYLE"===o)return;let r=!1;d.has(e)?i?r=!0:(d.delete(e),augmentAttribute(t,e,M)):i&&!(null===(s=this._accessibleCheck)||void 0===s?void 0:s.call(this,e,u))&&augmentAttribute(t,e,M,"true")&&(d.set(e,!0),r=!0),r&&(h.push(new WeakHTMLElement(t.getWindow,e)),m.set(e,!0))},walk=e=>{var i;for(let s=y.getFirstElementChild(e);s;s=y.getNextElementSibling(s)){let e=!1,o=!1,r=!1;if(c){let n=t.getParent(s);for(let t of c){if(s===t){e=!0;break}if(y.nodeContains(s,t)){o=!0;break}y.nodeContains(t,n)&&(r=!0)}o||(null===(i=s.__tabsterElementFlags)||void 0===i?void 0:i.noDirectAriaHidden)?walk(s):e||r||toggle(s,!0)}else toggle(s,!1)}};c||a.forEach(e=>toggle(e,!1)),n.forEach(e=>toggle(e,!0)),i&&walk(i),null===(e=this._aug)||void 0===e||e.map(e=>e.get()).forEach(e=>{e&&!m.get(e)&&toggle(e,!1)}),this._aug=h,this._augMap=m}_restoreModalizerFocus(e){let t=null==e?void 0:e.ownerDocument;if(!e||!t)return;let i=RootAPI.getTabsterContext(this._tabster,e),s=null==i?void 0:i.modalizer,o=this.activeId;if(!s&&!o||s&&o===s.userId)return;let r=null==i?void 0:i.root.getElement();if(r){let t=this._tabster.focusable.findFirst({container:r,useActiveModalizer:!0});if(t){if(e.compareDocumentPosition(t)&document.DOCUMENT_POSITION_PRECEDING&&!(t=this._tabster.focusable.findLast({container:r,useActiveModalizer:!0})))throw Error("Something went wrong.");this._tabster.focusedElement.focus(t);return}}e.blur()}};let MoverDummyManager=class MoverDummyManager extends DummyInputManager{constructor(e,t,i,s){super(t,e,3,s),this._onFocusDummyInput=e=>{var t,i;let s=this._element.get(),r=e.input;if(s&&r){let n;let l=RootAPI.getTabsterContext(this._tabster,s);l&&(n=null===(t=FocusedElementState.findNextTabbable(this._tabster,l,void 0,r,void 0,!e.isFirst,!0))||void 0===t?void 0:t.element);let a=null===(i=this._getMemorized())||void 0===i?void 0:i.get();a&&(n=a),n&&(0,o.ev)(n)}},this._tabster=t,this._getMemorized=i,this._setHandlers(this._onFocusDummyInput)}};let Mover=class Mover extends TabsterPart{constructor(e,t,i,s,o){var r;super(e,t,s),this._visible={},this._onIntersection=e=>{for(let t of e){let e;let i=t.target,s=getElementUId(this._win,i),o=this._fullyVisible;if(t.intersectionRatio>=.25?(e=t.intersectionRatio>=.75?u.Visible:u.PartiallyVisible)===u.Visible&&(o=s):e=u.Invisible,this._visible[s]!==e){void 0===e?(delete this._visible[s],o===s&&delete this._fullyVisible):(this._visible[s]=e,this._fullyVisible=o);let t=this.getState(i);t&&i.dispatchEvent(new MoverStateEvent(t))}}},this._win=e.getWindow,this.visibilityTolerance=null!==(r=s.visibilityTolerance)&&void 0!==r?r:.8,(this._props.trackState||this._props.visibilityAware)&&(this._intersectionObserver=new IntersectionObserver(this._onIntersection,{threshold:[0,.25,.5,.75,1]}),this._observeState()),this._onDispose=i,e.controlTab||(this.dummyManager=new MoverDummyManager(this._element,e,()=>s.memorizeCurrent?this._current:void 0,o))}dispose(){var e;this._onDispose(this),this._intersectionObserver&&(this._intersectionObserver.disconnect(),delete this._intersectionObserver),delete this._current,delete this._fullyVisible,delete this._allElements,delete this._updateQueue,this._unobserve&&(this._unobserve(),delete this._unobserve);let t=this._win();this._setCurrentTimer&&(t.clearTimeout(this._setCurrentTimer),delete this._setCurrentTimer),this._updateTimer&&(t.clearTimeout(this._updateTimer),delete this._updateTimer),null===(e=this.dummyManager)||void 0===e||e.dispose(),delete this.dummyManager}setCurrent(e){e?this._current=new WeakHTMLElement(this._win,e):this._current=void 0,(this._props.trackState||this._props.visibilityAware)&&!this._setCurrentTimer&&(this._setCurrentTimer=this._win().setTimeout(()=>{var e;delete this._setCurrentTimer;let t=[];for(let i of(this._current!==this._prevCurrent&&(t.push(this._current),t.push(this._prevCurrent),this._prevCurrent=this._current),t)){let t=null==i?void 0:i.get();if(t&&(null===(e=this._allElements)||void 0===e?void 0:e.get(t))===this){let e=this._props;if(t&&(void 0!==e.visibilityAware||e.trackState)){let e=this.getState(t);e&&t.dispatchEvent(new MoverStateEvent(e))}}}}))}getCurrent(){var e;return(null===(e=this._current)||void 0===e?void 0:e.get())||null}findNextTabbable(e,t,i,s){var o;let r;let n=this.getElement(),l=n&&(null===(o=null==e?void 0:e.__tabsterDummyContainer)||void 0===o?void 0:o.get())===n;if(!n)return null;let a=null,u=!1;if(this._props.tabbable||l||e&&!y.nodeContains(n,e)){let o={};a=this._tabster.focusable[i?"findPrev":"findNext"]({currentElement:e,referenceElement:t,container:n,ignoreAccessibility:s,useActiveModalizer:!0},o),u=!!o.outOfDOMOrder,r=o.uncontrolled}return{element:a,uncontrolled:r,outOfDOMOrder:u}}acceptElement(e,t){var i,s,o;if(!FocusedElementState.isTabbing)return(null===(i=t.currentCtx)||void 0===i?void 0:i.excludedFromMover)?NodeFilter.FILTER_REJECT:void 0;let{memorizeCurrent:r,visibilityAware:n,hasDefault:l=!0}=this._props,a=this.getElement();if(a&&(r||n||l)&&(!y.nodeContains(a,t.from)||(null===(s=t.from.__tabsterDummyContainer)||void 0===s?void 0:s.get())===a)){let e;if(r){let i=null===(o=this._current)||void 0===o?void 0:o.get();i&&t.acceptCondition(i)&&(e=i)}if(!e&&l&&(e=this._tabster.focusable.findDefault({container:a,useActiveModalizer:!0})),!e&&n&&(e=this._tabster.focusable.findElement({container:a,useActiveModalizer:!0,isBackward:t.isBackward,acceptCondition:e=>{var i;let s=getElementUId(this._win,e),o=this._visible[s];return a!==e&&!!(null===(i=this._allElements)||void 0===i?void 0:i.get(e))&&t.acceptCondition(e)&&(o===u.Visible||o===u.PartiallyVisible&&(n===u.PartiallyVisible||!this._fullyVisible))}})),e)return t.found=!0,t.foundElement=e,t.rejectElementsFrom=a,t.skippedFocusable=!0,NodeFilter.FILTER_ACCEPT}}_observeState(){let e=this.getElement();if(this._unobserve||!e||"undefined"==typeof MutationObserver)return;let t=this._win(),i=this._allElements=new WeakMap,s=this._tabster.focusable,o=this._updateQueue=[],r=y.createMutationObserver(e=>{for(let t of e){let e=t.target,i=t.removedNodes,s=t.addedNodes;if("attributes"===t.type)"tabindex"===t.attributeName&&o.push({element:e,type:2});else{for(let e=0;e<i.length;e++)o.push({element:i[e],type:3});for(let e=0;e<s.length;e++)o.push({element:s[e],type:1})}}requestUpdate()}),setElement=(e,t)=>{var s,o;let r=i.get(e);r&&t&&(null===(s=this._intersectionObserver)||void 0===s||s.unobserve(e),i.delete(e)),r||t||(i.set(e,this),null===(o=this._intersectionObserver)||void 0===o||o.observe(e))},updateElement=e=>{let t=s.isFocusable(e),o=i.get(e);o?t||setElement(e,!0):t&&setElement(e)},addNewElements=e=>{let{mover:i}=getMoverGroupper(e);if(i&&i!==this){if(!(i.getElement()===e&&s.isFocusable(e)))return;setElement(e)}let o=createElementTreeWalker(t.document,e,e=>{let{mover:t,groupper:i}=getMoverGroupper(e);if(t&&t!==this)return NodeFilter.FILTER_REJECT;let o=null==i?void 0:i.getFirst(!0);return i&&i.getElement()!==e&&o&&o!==e?NodeFilter.FILTER_REJECT:(s.isFocusable(e)&&setElement(e),NodeFilter.FILTER_SKIP)});if(o)for(o.currentNode=e;o.nextNode(););},removeWalk=e=>{let t=i.get(e);t&&setElement(e,!0);for(let t=y.getFirstElementChild(e);t;t=y.getNextElementSibling(t))removeWalk(t)},requestUpdate=()=>{!this._updateTimer&&o.length&&(this._updateTimer=t.setTimeout(()=>{for(let{element:e,type:t}of(delete this._updateTimer,o))switch(t){case 2:updateElement(e);break;case 1:addNewElements(e);break;case 3:removeWalk(e)}o=this._updateQueue=[]},0))},getMoverGroupper=e=>{let t={};for(let i=e;i;i=y.getParentElement(i)){let e=getTabsterOnElement(this._tabster,i);if(e&&(e.groupper&&!t.groupper&&(t.groupper=e.groupper),e.mover)){t.mover=e.mover;break}}return t};o.push({element:e,type:1}),requestUpdate(),r.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["tabindex"]}),this._unobserve=()=>{r.disconnect()}}getState(e){let t=getElementUId(this._win,e);if(t in this._visible){let i=this._visible[t]||u.Invisible,s=this._current?this._current.get()===e:void 0;return{isCurrent:s,visibility:i}}}};let MoverAPI=class MoverAPI{constructor(e,t){this._init=()=>{let e=this._win();e.addEventListener("keydown",this._onKeyDown,!0),e.addEventListener(f,this._onMoveFocus),e.addEventListener(p,this._onMemorizedElement),this._tabster.focusedElement.subscribe(this._onFocus)},this._onMoverDispose=e=>{delete this._movers[e.id]},this._onFocus=e=>{var t;let i=e,s=e;for(let o=y.getParentElement(e);o;o=y.getParentElement(o)){let e=null===(t=getTabsterOnElement(this._tabster,o))||void 0===t?void 0:t.mover;e&&(e.setCurrent(s),i=void 0),!i&&this._tabster.focusable.isFocusable(o)&&(i=s=o)}},this._onKeyDown=async e=>{var t;let i;if(this._ignoredInputTimer&&(this._win().clearTimeout(this._ignoredInputTimer),delete this._ignoredInputTimer),null===(t=this._ignoredInputResolve)||void 0===t||t.call(this,!1),e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)return;let s=e.key;if(s===C.ArrowDown?i=h.ArrowDown:s===C.ArrowRight?i=h.ArrowRight:s===C.ArrowUp?i=h.ArrowUp:s===C.ArrowLeft?i=h.ArrowLeft:s===C.PageDown?i=h.PageDown:s===C.PageUp?i=h.PageUp:s===C.Home?i=h.Home:s===C.End&&(i=h.End),!i)return;let o=this._tabster.focusedElement.getFocusedElement();!o||await this._isIgnoredInput(o,s)||this._moveFocus(o,i,e)},this._onMoveFocus=e=>{var t;let i=e.composedPath()[0],s=null===(t=e.detail)||void 0===t?void 0:t.key;i&&void 0!==s&&!e.defaultPrevented&&(this._moveFocus(i,s),e.stopImmediatePropagation())},this._onMemorizedElement=e=>{var t;let i=e.composedPath()[0],s=null===(t=e.detail)||void 0===t?void 0:t.memorizedElement;if(i){let t=RootAPI.getTabsterContext(this._tabster,i),o=null==t?void 0:t.mover;o&&(s&&!y.nodeContains(o.getElement(),s)&&(s=void 0),o.setCurrent(s),e.stopImmediatePropagation())}},this._tabster=e,this._win=t,this._movers={},e.queueInit(this._init)}dispose(){var e;let t=this._win();this._tabster.focusedElement.unsubscribe(this._onFocus),null===(e=this._ignoredInputResolve)||void 0===e||e.call(this,!1),this._ignoredInputTimer&&(t.clearTimeout(this._ignoredInputTimer),delete this._ignoredInputTimer),t.removeEventListener("keydown",this._onKeyDown,!0),t.removeEventListener(f,this._onMoveFocus),t.removeEventListener(p,this._onMemorizedElement),Object.keys(this._movers).forEach(e=>{this._movers[e]&&(this._movers[e].dispose(),delete this._movers[e])})}createMover(e,t,i){let s=new Mover(this._tabster,e,this._onMoverDispose,t,i);return this._movers[s.id]=s,s}moveFocus(e,t){return this._moveFocus(e,t)}_moveFocus(e,t,i){var s,r;let n,l,a;let u=this._tabster,d=RootAPI.getTabsterContext(u,e,{checkRtl:!0});if(!d||!d.mover||d.excludedFromMover||i&&d.ignoreKeydown(i))return null;let m=d.mover,_=m.getElement();if(d.groupperBeforeMover){let e=d.groupper;if(!e||e.isActive(!0))return null;for(let t=y.getParentElement(e.getElement());t&&t!==_;t=y.getParentElement(t))if(null===(r=null===(s=getTabsterOnElement(u,t))||void 0===s?void 0:s.groupper)||void 0===r?void 0:r.isActive(!0))return null}if(!_)return null;let v=u.focusable,b=m.getProps(),f=b.direction||c.Both,p=f===c.Both,g=p||f===c.Vertical,E=p||f===c.Horizontal,T=f===c.GridLinear,w=T||f===c.Grid,F=b.cyclic,I=0,C=0;if(w&&(I=Math.ceil((a=e.getBoundingClientRect()).left),C=Math.floor(a.right)),d.rtl&&(t===h.ArrowRight?t=h.ArrowLeft:t===h.ArrowLeft&&(t=h.ArrowRight)),t===h.ArrowDown&&g||t===h.ArrowRight&&(E||w)){if((n=v.findNext({currentElement:e,container:_,useActiveModalizer:!0}))&&w){let e=Math.ceil(n.getBoundingClientRect().left);!T&&C>e&&(n=void 0)}else!n&&F&&(n=v.findFirst({container:_,useActiveModalizer:!0}))}else if(t===h.ArrowUp&&g||t===h.ArrowLeft&&(E||w)){if((n=v.findPrev({currentElement:e,container:_,useActiveModalizer:!0}))&&w){let e=Math.floor(n.getBoundingClientRect().right);!T&&e>I&&(n=void 0)}else!n&&F&&(n=v.findLast({container:_,useActiveModalizer:!0}))}else if(t===h.Home)w?v.findElement({container:_,currentElement:e,useActiveModalizer:!0,isBackward:!0,acceptCondition:t=>{var i;if(!v.isFocusable(t))return!1;let s=Math.ceil(null!==(i=t.getBoundingClientRect().left)&&void 0!==i?i:0);return t!==e&&I<=s||(n=t,!1)}}):n=v.findFirst({container:_,useActiveModalizer:!0});else if(t===h.End)w?v.findElement({container:_,currentElement:e,useActiveModalizer:!0,acceptCondition:t=>{var i;if(!v.isFocusable(t))return!1;let s=Math.ceil(null!==(i=t.getBoundingClientRect().left)&&void 0!==i?i:0);return t!==e&&I>=s||(n=t,!1)}}):n=v.findLast({container:_,useActiveModalizer:!0});else if(t===h.PageUp){if(v.findElement({currentElement:e,container:_,useActiveModalizer:!0,isBackward:!0,acceptCondition:e=>!!v.isFocusable(e)&&(!isElementVerticallyVisibleInContainer(this._win,e,m.visibilityTolerance)||(n=e,!1))}),w&&n){let e=Math.ceil(n.getBoundingClientRect().left);v.findElement({currentElement:n,container:_,useActiveModalizer:!0,acceptCondition:t=>{if(!v.isFocusable(t))return!1;let i=Math.ceil(t.getBoundingClientRect().left);return I<i||e>=i||(n=t,!1)}})}l=!1}else if(t===h.PageDown){if(v.findElement({currentElement:e,container:_,useActiveModalizer:!0,acceptCondition:e=>!!v.isFocusable(e)&&(!isElementVerticallyVisibleInContainer(this._win,e,m.visibilityTolerance)||(n=e,!1))}),w&&n){let e=Math.ceil(n.getBoundingClientRect().left);v.findElement({currentElement:n,container:_,useActiveModalizer:!0,isBackward:!0,acceptCondition:t=>{if(!v.isFocusable(t))return!1;let i=Math.ceil(t.getBoundingClientRect().left);return I>i||e<=i||(n=t,!1)}})}l=!0}else if(w){let i,s;let o=t===h.ArrowUp,r=I,l=Math.ceil(a.top),u=C,d=Math.floor(a.bottom),c=0;v.findAll({container:_,currentElement:e,isBackward:o,onElement:e=>{let t=e.getBoundingClientRect(),n=Math.ceil(t.left),a=Math.ceil(t.top),h=Math.floor(t.right),m=Math.floor(t.bottom);if(o&&l<m||!o&&d>a)return!0;let _=Math.ceil(Math.min(u,h))-Math.floor(Math.max(r,n)),v=Math.ceil(Math.min(u-r,h-n));if(_>0&&v>=_){let t=_/v;t>c&&(i=e,c=t)}else if(0===c){let t=function(e,t,i,s,o,r,n,l){let a=i<o?o-i:n<e?e-n:0,u=s<r?r-s:l<t?t-l:0;return 0===a?u:0===u?a:Math.sqrt(a*a+u*u)}(r,l,u,d,n,a,h,m);(void 0===s||t<s)&&(s=t,i=e)}else if(c>0)return!1;return!0}}),n=i}return n&&(!i||i&&_.dispatchEvent(new TabsterMoveFocusEvent({by:"mover",owner:_,next:n,relatedEvent:i})))?(void 0!==l&&function(e,t,i){let s=getScrollableContainer(t);if(s){let o=getBoundingRect(e,s),r=t.getBoundingClientRect();i?s.scrollTop+=r.top-o.top:s.scrollTop+=r.bottom-o.bottom}}(this._win,n,l),i&&(i.preventDefault(),i.stopImmediatePropagation()),(0,o.ev)(n),n):null}async _isIgnoredInput(e,t){if("true"===e.getAttribute("aria-expanded")&&e.hasAttribute("aria-activedescendant"))return!0;if(matchesSelector(e,"input, textarea, *[contenteditable]")){let i,s=0,o=0,r=0;if("INPUT"===e.tagName||"TEXTAREA"===e.tagName){let i=e.type,n=e.value;if(r=(n||"").length,"email"===i||"number"===i){if(r){let i=y.getSelection(e);if(i){let e=i.toString().length,s=t===C.ArrowLeft||t===C.ArrowUp;if(i.modify("extend",s?"backward":"forward","character"),e!==i.toString().length)return i.modify("extend",s?"forward":"backward","character"),!0;r=0}}}else{let t=e.selectionStart;if(null===t)return"hidden"===i;s=t||0,o=e.selectionEnd||0}}else"true"===e.contentEditable&&(i=new(function(e){let t=getInstanceContext(e);if(t.basics.Promise)return t.basics.Promise;throw Error("No Promise defined.")}(this._win))(t=>{this._ignoredInputResolve=e=>{delete this._ignoredInputResolve,t(e)};let i=this._win();this._ignoredInputTimer&&i.clearTimeout(this._ignoredInputTimer);let{anchorNode:n,focusNode:l,anchorOffset:a,focusOffset:u}=y.getSelection(e)||{};this._ignoredInputTimer=i.setTimeout(()=>{var t,i,d;delete this._ignoredInputTimer;let{anchorNode:c,focusNode:h,anchorOffset:m,focusOffset:_}=y.getSelection(e)||{};if(c!==n||h!==l||m!==a||_!==u){null===(t=this._ignoredInputResolve)||void 0===t||t.call(this,!1);return}if(s=m||0,o=_||0,r=(null===(i=e.textContent)||void 0===i?void 0:i.length)||0,c&&h&&y.nodeContains(e,c)&&y.nodeContains(e,h)&&c!==e){let t=!1,addOffsets=e=>{if(e===c)t=!0;else if(e===h)return!0;let i=e.textContent;if(i&&!y.getFirstChild(e)){let e=i.length;t?h!==c&&(o+=e):(s+=e,o+=e)}let r=!1;for(let t=y.getFirstChild(e);t&&!r;t=t.nextSibling)r=addOffsets(t);return r};addOffsets(e)}null===(d=this._ignoredInputResolve)||void 0===d||d.call(this,!0)},0)}));if(i&&!await i||s!==o||s>0&&(t===C.ArrowLeft||t===C.ArrowUp||t===C.Home)||s<r&&(t===C.ArrowRight||t===C.ArrowDown||t===C.End))return!0}return!1}};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */let UncontrolledAPI=class UncontrolledAPI{constructor(e){this._isUncontrolledCompletely=e}isUncontrolledCompletely(e,t){var i;let s=null===(i=this._isUncontrolledCompletely)||void 0===i?void 0:i.call(this,e,t);return void 0===s?t:s}};let Restorer=class Restorer extends TabsterPart{constructor(e,t,i){var s;if(super(e,t,i),this._hasFocus=!1,this._onFocusOut=e=>{var t;let i=null===(t=this._element)||void 0===t?void 0:t.get();i&&null===e.relatedTarget&&i.dispatchEvent(new RestorerRestoreFocusEvent),i&&!y.nodeContains(i,e.relatedTarget)&&(this._hasFocus=!1)},this._onFocusIn=()=>{this._hasFocus=!0},this._props.type===d.Source){let e=null===(s=this._element)||void 0===s?void 0:s.get();null==e||e.addEventListener("focusout",this._onFocusOut),null==e||e.addEventListener("focusin",this._onFocusIn),this._hasFocus=y.nodeContains(e,e&&y.getActiveElement(e.ownerDocument))}}dispose(){var e;if(this._props.type===d.Source){let t=null===(e=this._element)||void 0===e?void 0:e.get();if(null==t||t.removeEventListener("focusout",this._onFocusOut),null==t||t.removeEventListener("focusin",this._onFocusIn),this._hasFocus){let e=this._tabster.getWindow().document;e.body.dispatchEvent(new RestorerRestoreFocusEvent)}}}};let RestorerAPI=class RestorerAPI{constructor(e){this._history=[],this._onRestoreFocus=e=>{this._focusedElementState.cancelAsyncFocus(a.Restorer);let t=e.composedPath()[0];t&&this._focusedElementState.requestAsyncFocus(a.Restorer,()=>this._restoreFocus(t),0)},this._onFocusIn=e=>{var t;if(!e)return;let i=getTabsterOnElement(this._tabster,e);(null===(t=null==i?void 0:i.restorer)||void 0===t?void 0:t.getProps().type)===d.Target&&this._addToHistory(e)},this._restoreFocus=e=>{var t;let i=this._getWindow().document;if(y.getActiveElement(i)!==i.body||!this._keyboardNavState.isNavigatingWithKeyboard()&&y.nodeContains(i.body,e))return;let s=this._history.pop();for(;s&&!y.nodeContains(i.body,y.getParentElement(s.get()));)s=this._history.pop();null===(t=null==s?void 0:s.get())||void 0===t||t.focus()},this._tabster=e,this._getWindow=e.getWindow,this._getWindow().addEventListener(E,this._onRestoreFocus),this._keyboardNavState=e.keyboardNavigation,this._focusedElementState=e.focusedElement,this._focusedElementState.subscribe(this._onFocusIn)}dispose(){let e=this._getWindow();this._focusedElementState.unsubscribe(this._onFocusIn),this._focusedElementState.cancelAsyncFocus(a.Restorer),e.removeEventListener(E,this._onRestoreFocus)}_addToHistory(e){var t;(null===(t=this._history[this._history.length-1])||void 0===t?void 0:t.get())!==e&&(this._history.length>10&&this._history.shift(),this._history.push(new WeakHTMLElement(this._getWindow,e)))}createRestorer(e,t){let i=new Restorer(this._tabster,e,t);return t.type===d.Target&&y.getActiveElement(e.ownerDocument)===e&&this._addToHistory(e),i}};function getLastChild$1(e){return e?!e.lastChild&&e.shadowRoot?getLastChild$1(e.shadowRoot):e.lastChild:null}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */let ShadowMutationObserver=class ShadowMutationObserver{static _overrideAttachShadow(e){let t=e.Element.prototype.attachShadow;t.__origAttachShadow||(Element.prototype.attachShadow=function(e){let i=t.call(this,e);for(let e of ShadowMutationObserver._shadowObservers)e._addSubObserver(i);return i},Element.prototype.attachShadow.__origAttachShadow=t)}constructor(e){this._isObserving=!1,this._callbackWrapper=(e,t)=>{for(let t of e)if("childList"===t.type){let e=t.removedNodes,i=t.addedNodes;for(let t=0;t<e.length;t++)this._walkShadows(e[t],!0);for(let e=0;e<i.length;e++)this._walkShadows(i[e])}this._callback(e,t)},this._callback=e,this._observer=new MutationObserver(this._callbackWrapper),this._subObservers=new Map}_addSubObserver(e){if(!(!this._options||!this._callback||this._subObservers.has(e))&&this._options.subtree&&function(e,t){var i,s;if(!e||!t)return!1;let o=t;for(;o;){if(o===e)return!0;o="function"!=typeof o.assignedElements&&(null===(i=o.assignedSlot)||void 0===i?void 0:i.parentNode)?null===(s=o.assignedSlot)||void 0===s?void 0:s.parentNode:o.nodeType===document.DOCUMENT_FRAGMENT_NODE?o.host:o.parentNode}return!1}(this._root,e)){let t=new MutationObserver(this._callbackWrapper);this._subObservers.set(e,t),this._isObserving&&t.observe(e,this._options),this._walkShadows(e)}}disconnect(){for(let e of(this._isObserving=!1,delete this._options,ShadowMutationObserver._shadowObservers.delete(this),this._subObservers.values()))e.disconnect();this._subObservers.clear(),this._observer.disconnect()}observe(e,t){let i=e.nodeType===Node.DOCUMENT_NODE?e:e.ownerDocument,s=null==i?void 0:i.defaultView;i&&s&&(ShadowMutationObserver._overrideAttachShadow(s),ShadowMutationObserver._shadowObservers.add(this),this._root=e,this._options=t,this._isObserving=!0,this._observer.observe(e,t),this._walkShadows(e))}_walkShadows(e,t){let i=e.nodeType===Node.DOCUMENT_NODE?e:e.ownerDocument;if(!i)return;if(e===i)e=i.body;else{let t=e.shadowRoot;if(t){this._addSubObserver(t);return}}let s=i.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{if(e.nodeType===Node.ELEMENT_NODE){if(t){let t=this._subObservers.get(e);t&&(t.disconnect(),this._subObservers.delete(e))}else{let t=e.shadowRoot;t&&this._addSubObserver(t)}}return NodeFilter.FILTER_SKIP}});s.nextNode()}takeRecords(){let e=this._observer.takeRecords();for(let t of this._subObservers.values())e.push(...t.takeRecords());return e}};ShadowMutationObserver._shadowObservers=new Set;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */let Tabster=class Tabster{constructor(e){this.keyboardNavigation=e.keyboardNavigation,this.focusedElement=e.focusedElement,this.focusable=e.focusable,this.root=e.root,this.uncontrolled=e.uncontrolled,this.core=e}};let TabsterCore=class TabsterCore{constructor(e,t){var i,s;this._forgetMemorizedElements=[],this._wrappers=new Set,this._initQueue=[],this._version="7.1.1",this._noop=!1,this.getWindow=()=>{if(!this._win)throw Error("Using disposed Tabster.");return this._win},this._storage=function(e){let t=e.__tabsterInstanceContext;return new((null==t?void 0:t.basics.WeakMap)||WeakMap)}(e),this._win=e;let o=this.getWindow;(null==t?void 0:t.DOMAPI)&&function(e){for(let t of Object.keys(e))y[t]=e[t]}({...t.DOMAPI}),this.keyboardNavigation=new KeyboardNavigationState(o),this.focusedElement=new FocusedElementState(this,o),this.focusable=new FocusableAPI(this),this.root=new RootAPI(this,null==t?void 0:t.autoRoot),this.uncontrolled=new UncontrolledAPI((null==t?void 0:t.checkUncontrolledCompletely)||(null==t?void 0:t.checkUncontrolledTrappingFocus)),this.controlTab=null===(i=null==t?void 0:t.controlTab)||void 0===i||i,this.rootDummyInputs=!!(null==t?void 0:t.rootDummyInputs),this._dummyObserver=new DummyInputObserver(o),this.getParent=null!==(s=null==t?void 0:t.getParent)&&void 0!==s?s:y.getParentNode,this.internal={stopObserver:()=>{this._unobserve&&(this._unobserve(),delete this._unobserve)},resumeObserver:e=>{if(!this._unobserve){let t=o().document;this._unobserve=/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */function(e,t,i,s){let o;if("undefined"==typeof MutationObserver)return()=>{};let n=t.getWindow;function updateTabsterElements(t,i){o||(o=getInstanceContext(n).elementByUId),processNode(t,i);let s=createElementTreeWalker(e,t,e=>processNode(e,i));if(s)for(;s.nextNode(););}function processNode(e,s){var l;if(!e.getAttribute)return NodeFilter.FILTER_SKIP;let a=e.__tabsterElementUID;return a&&o&&(s?delete o[a]:null!==(l=o[a])&&void 0!==l||(o[a]=new WeakHTMLElement(n,e))),(getTabsterOnElement(t,e)||e.hasAttribute(r))&&i(t,e,s),NodeFilter.FILTER_SKIP}let l=y.createMutationObserver(e=>{var s,o,n,l,a;let u=new Set;for(let a of e){let e=a.target,d=a.removedNodes,c=a.addedNodes;if("attributes"===a.type)a.attributeName!==r||u.has(e)||i(t,e);else{for(let i=0;i<d.length;i++){let r=d[i];u.add(r),updateTabsterElements(r,!0),null===(o=(s=t._dummyObserver).domChanged)||void 0===o||o.call(s,e)}for(let i=0;i<c.length;i++)updateTabsterElements(c[i]),null===(l=(n=t._dummyObserver).domChanged)||void 0===l||l.call(n,e)}}u.clear(),null===(a=t.modalizer)||void 0===a||a.hiddenUpdate()});return s&&updateTabsterElements(n().document.body),l.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:[r]}),()=>{l.disconnect()}}(t,this,updateTabsterByAttribute,e)}}},function startFakeWeakRefsCleanup(e){let t=getInstanceContext(e);t.fakeWeakRefsStarted||(t.fakeWeakRefsStarted=!0,t.WeakRef=t.basics.WeakRef),t.fakeWeakRefsTimer||(t.fakeWeakRefsTimer=e().setTimeout(()=>{t.fakeWeakRefsTimer=void 0,cleanupFakeWeakRefs(e),startFakeWeakRefsCleanup(e)},12e4))}(o),this.queueInit(()=>{this.internal.resumeObserver(!0)})}_mergeProps(e){var t;e&&(this.getParent=null!==(t=e.getParent)&&void 0!==t?t:this.getParent)}createTabster(e,t){let i=new Tabster(this);return e||this._wrappers.add(i),this._mergeProps(t),i}disposeTabster(e,t){t?this._wrappers.clear():this._wrappers.delete(e),0===this._wrappers.size&&this.dispose()}dispose(){var e,t,i,s,o,r,n,l;this.internal.stopObserver();let a=this._win;null==a||a.clearTimeout(this._initTimer),delete this._initTimer,this._initQueue=[],this._forgetMemorizedElements=[],a&&this._forgetMemorizedTimer&&(a.clearTimeout(this._forgetMemorizedTimer),delete this._forgetMemorizedTimer),null===(e=this.outline)||void 0===e||e.dispose(),null===(t=this.crossOrigin)||void 0===t||t.dispose(),null===(i=this.deloser)||void 0===i||i.dispose(),null===(s=this.groupper)||void 0===s||s.dispose(),null===(o=this.mover)||void 0===o||o.dispose(),null===(r=this.modalizer)||void 0===r||r.dispose(),null===(n=this.observedElement)||void 0===n||n.dispose(),null===(l=this.restorer)||void 0===l||l.dispose(),this.keyboardNavigation.dispose(),this.focusable.dispose(),this.focusedElement.dispose(),this.root.dispose(),this._dummyObserver.dispose(),function(e){let t=getInstanceContext(e);t.fakeWeakRefsStarted=!1,t.fakeWeakRefsTimer&&(e().clearTimeout(t.fakeWeakRefsTimer),t.fakeWeakRefsTimer=void 0,t.fakeWeakRefs=[])}(this.getWindow),clearElementCache(this.getWindow),this._storage=new WeakMap,this._wrappers.clear(),a&&(function(e){let t=e.__tabsterInstanceContext;t&&(t.elementByUId={},delete t.WeakRef,t.containerBoundingRectCache={},t.containerBoundingRectCacheTimer&&e.clearTimeout(t.containerBoundingRectCacheTimer),t.fakeWeakRefsTimer&&e.clearTimeout(t.fakeWeakRefsTimer),t.fakeWeakRefs=[],delete e.__tabsterInstanceContext)}(a),delete a.__tabsterInstance,delete this._win)}storageEntry(e,t){let i=this._storage,s=i.get(e);return s?!1===t&&0===Object.keys(s).length&&i.delete(e):!0===t&&(s={},i.set(e,s)),s}forceCleanup(){this._win&&(this._forgetMemorizedElements.push(this._win.document.body),this._forgetMemorizedTimer||(this._forgetMemorizedTimer=this._win.setTimeout(()=>{delete this._forgetMemorizedTimer;for(let e=this._forgetMemorizedElements.shift();e;e=this._forgetMemorizedElements.shift())clearElementCache(this.getWindow,e),FocusedElementState.forgetMemorized(this.focusedElement,e)},0),cleanupFakeWeakRefs(this.getWindow,!0)))}queueInit(e){var t;this._win&&(this._initQueue.push(e),this._initTimer||(this._initTimer=null===(t=this._win)||void 0===t?void 0:t.setTimeout(()=>{delete this._initTimer,this.drainInitQueue()},0)))}drainInitQueue(){if(!this._win)return;let e=this._initQueue;this._initQueue=[],e.forEach(e=>e())}};function createTabster(e,t){let i=e.__tabsterInstance;return i?i.createTabster(!1,t):(i=new TabsterCore(e,t),e.__tabsterInstance=i,i.createTabster())}function getGroupper(e){let t=e.core;return t.groupper||(t.groupper=new GroupperAPI(t,t.getWindow)),t.groupper}function getMover(e){let t=e.core;return t.mover||(t.mover=new MoverAPI(t,t.getWindow)),t.mover}function getModalizer(e,t,i){let s=e.core;return s.modalizer||(s.modalizer=new ModalizerAPI(s,t,i)),s.modalizer}function getRestorer(e){let t=e.core;return t.restorer||(t.restorer=new RestorerAPI(t)),t.restorer}function disposeTabster(e,t){e.core.disposeTabster(e,t)}}}]);